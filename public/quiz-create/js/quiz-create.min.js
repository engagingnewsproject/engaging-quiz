jQuery(document).ready(function(e){function n(e){for(var n=0;n<e.success.length;n++)o(e.success[n],"success");for(var t=0;t<e.error.length;t++)o(e.error[t],"error")}function o(n,o){responseTime=event.timeStamp,e(".enp-quiz-message-ajax-container").append('<div class="enp-quiz-message enp-quiz-message--ajax enp-quiz-message--'+o+" enp-container enp-message-"+responseTime+'"><ul class="enp-message__list enp-message__list--'+o+'">'+n+"</ul></div>"),e(".enp-message-"+responseTime).delay(3500).fadeOut(function(){e(".enp-message-"+responseTime).fadeOut()})}function t(n){var o,t;o=e("#enp-question--"+n).prev(".enp-accordion-header"),o.addClass("enp-question--remove").delay(300).slideUp(function(){o.remove()}),t=e("#enp-question--"+n),t.next().focus(),t.addClass("enp-question--remove").slideUp(function(){t.remove()})}function i(n){var o;o=e("#enp-mc-option--"+n),o.next(".enp-mc-option").find("button:first").focus(),o.addClass("enp-mc-option--remove").slideUp(function(){o.remove()})}function s(n,o){return e("#enp-mc-option--"+n).hasClass("enp-mc-option--correct")?(e("#enp-mc-option--"+n).removeClass("enp-mc-option--correct"),!1):(e("#enp-question--"+o+" .enp-mc-option").removeClass("enp-mc-option--correct"),void e("#enp-mc-option--"+n).addClass("enp-mc-option--correct"))}function a(n,o){var t,i,s;s=e("#enp-question--"+o+" .enp-mc-option--add"),t=e(s).prev(".enp-mc-option").clone(),i=e(".enp-mc-option-id",t).val(),t.hasClass("enp-mc-option--correct")&&t.removeClass("enp-mc-option--correct"),e(".enp-mc-option__input",t).val(""),e(".enp-mc-option-id",t).val(n),e(".enp-mc-option__button--delete",t).val("mc-option--delete-"+n),e(".enp-mc-option__button--correct",t).val("mc-option--correct__question-"+o+"__mc-option-"+n),e(t).attr("id","enp-mc-option--"+n),e("input",t).each(function(){var n=e(this).prop("name"),o=/\[mc_option\]\[(.*?)\]/,t=n.match(o)[1],i=parseInt(t)+1;new_inputName=n.replace(o,"[mc_option]["+i+"]"),e(this).attr("name",new_inputName)}),e(s).before(t),e("#enp-mc-option--"+n+" .enp-input").focus()}function c(e,n){for(var o=0;o<n.length;o++)if(n[o].question_id==e)for(var t=0;t<n[o].mc_option.length;t++)if("insert"===n[o].mc_option[t].action){var i=n[o].mc_option[t].mc_option_id;return i}}e(".enp-question-content").each(function(){var n,o,t;o=e(".enp-question-title__textarea",this).val(),(void 0===o||""===o)&&(o="Untitled"),t=e(this),n={title:o,content:t},n=enp_accordion__create_headers(n),enp_accordion__setup(n)}),e(document).on("keyup",".enp-question-title__textarea",function(){console.log("keyup"),question_title=e(this).val(),e(this).closest(".enp-question-content").prev(".enp-accordion-header").text(question_title)}),e(document).on("click",".enp-quiz-submit",function(o){o.preventDefault(),e(this).hasClass("enp-quiz-submit--wait")?console.log("waiting..."):(e(".enp-quiz-message-ajax-container").append('<p class="enp-quiz-message--saving">Saving...</p>'),e(".enp-quiz-submit").addClass("enp-quiz-submit--wait")),e.ajax({type:"POST",url:quizCreate.ajax_url,data:{action:"save_quiz",quiz:e(".enp-quiz-form").serialize(),quizSubmit:e(this).val()},beforeSend:function(e){console.log("Before send",e)}}).done(function(e,n,o){}).fail(function(e,n,o){console.log("AJAX failed",e.getAllResponseHeaders(),n,o)}).then(function(o,p,r){console.log("AJAX after finished"),console.log(r.responseJSON);var u=e.parseJSON(r.responseJSON),m=u.user_action.action,l=u.user_action.element;"delete"==m&&"question"==l?t(u.user_action.details.question_id):"delete"==m&&"mc_option"==l?i(u.user_action.details.mc_option_id):"add"==m&&"mc_option"==l?(new_mcOptionID=c(u.user_action.details.question_id,u.question),a(new_mcOptionID,u.user_action.details.question_id)):"set_correct"==m&&"mc_option"==l&&s(u.user_action.details.mc_option_id,u.user_action.details.question_id),n(u.message)}).always(function(){e(".enp-quiz-submit").removeClass("enp-quiz-submit--wait"),e(".enp-quiz-message--saving").remove()})}),e("#enp-quiz").append('<section class="enp-quiz-message-ajax-container"></section>')});