jQuery(document).ready(function(e){function n(n){var t,i;e.ajax({type:"POST",url:quizCreate.ajax_url,data:{action:"save_quiz",quiz:e(".enp-quiz-form").serialize(),quizSubmit:n},beforeSend:function(e){console.log("Before send",e)}}).done(function(n,s,p){if(console.log(p.responseJSON),n=e.parseJSON(p.responseJSON),t=n.user_action.action,i=n.user_action.element,"success"===n.status&&"insert"===n.action)o(n);else if("delete"==t&&"question"==i)questionID=n.user_action.details.question_id,questionResponse=v(questionID,n.question),questionResponse!==!1&&"update"===questionResponse.action&&"success"===questionResponse.status?u(questionID):r(questionID);else if("delete"==t&&"mc_option"==i){var c=n.user_action.details.mc_option_id;mcOptionResponse=g(c,n.question),mcOptionResponse!==!1&&"update"===mcOptionResponse.action&&"success"===mcOptionResponse.status?m(c):d(c)}else if("add"==t&&"mc_option"==i){questionID=n.user_action.details.question_id;var l=q(questionID,n.question);f(l,questionID)}else"set_correct"==t&&"mc_option"==i&&_(n.user_action.details.mc_option_id,n.user_action.details.question_id);a(n.message)}).fail(function(e,n,o){console.log("AJAX failed",e.getAllResponseHeaders(),n,o)}).then(function(e,n,o){console.log("AJAX after finished")}).always(function(){s()})}function o(n){e("#enp-quiz-id").val(n.quiz_id);var o=e("body").innerHTML,t=e(".enp-quiz-title__textarea").val();t="Quiz: "+t;var i=quizCreate.quiz_create_url+n.quiz_id;window.history.pushState({html:o,pageTitle:t},"",i)}function t(e){var n;if(console.log(e),e.indexOf("question--delete")>-1){n=/question--delete-/g;var o=e.replace(n,"");c(o)}else if(e.indexOf("mc-option--delete")>-1){n=/mc-option--delete-/g;var t=e.replace(n,"");l(t)}}function i(){e(".enp-quiz-message-ajax-container").append('<p class="enp-quiz-message--saving">Saving...</p>'),e(".enp-quiz-submit").addClass("enp-quiz-submit--wait")}function s(){e(".enp-quiz-submit").removeClass("enp-quiz-submit--wait"),e(".enp-quiz-message--saving").remove()}function a(e){p(e.success[0],"success");for(var n=0;n<e.error.length;n++)p(e.error[n],"error")}function p(n,o){var t=Math.floor(1e3*Math.random()+1);e(".enp-quiz-message-ajax-container").append('<div class="enp-quiz-message enp-quiz-message--ajax enp-quiz-message--'+o+" enp-container enp-message-"+t+'"><p class="enp-message__list enp-message__list--'+o+'">'+n+"</p></div>"),e(".enp-message-"+t).delay(3500).fadeOut(function(){e(".enp-message-"+t).fadeOut()})}function c(n){var o,t;o=e("#enp-question--"+n).prev(".enp-accordion-header"),o.addClass("enp-question--remove"),t=e("#enp-question--"+n),t.next().focus(),t.addClass("enp-question--remove")}function r(n){var o;o=e("#enp-question--"+n).prev(".enp-accordion-header"),o.removeClass("enp-question--remove"),e("#enp-question--"+n).removeClass("enp-question--remove"),p("Question could not be deleted. Please reload the page and try again.","error")}function u(n){e("#enp-question--"+n).prev(".enp-accordion-header").remove(),e("#enp-question--"+n).remove(),p("Question deleted.","success")}function l(n){var o;o=e("#enp-mc-option--"+n),o.next(".enp-mc-option").find("button:first").focus(),o.addClass("enp-mc-option--remove")}function m(n){e("#enp-mc-option--"+n).remove()}function d(n){var o;o=e("#enp-mc-option--"+n),o.removeClass("enp-mc-option--remove"),e(".enp-mc-option__button--delete",o).focus(),p("Multiple Choice Option could not be deleted. Please reload the page and try again.","error")}function _(n,o){return e("#enp-mc-option--"+n).hasClass("enp-mc-option--correct")?(e("#enp-mc-option--"+n).removeClass("enp-mc-option--correct"),!1):(e("#enp-question--"+o+" .enp-mc-option").removeClass("enp-mc-option--correct"),void e("#enp-mc-option--"+n).addClass("enp-mc-option--correct"))}function f(n,o){var t,i,s;s=e("#enp-question--"+o+" .enp-mc-option--add"),t=e(s).prev(".enp-mc-option").clone(),i=e(".enp-mc-option-id",t).val(),t.hasClass("enp-mc-option--correct")&&t.removeClass("enp-mc-option--correct"),e(".enp-mc-option__input",t).val(""),e(".enp-mc-option-id",t).val(n),e(".enp-mc-option__button--delete",t).val("mc-option--delete-"+n),e(".enp-mc-option__button--correct",t).val("mc-option--correct__question-"+o+"__mc-option-"+n),e(t).attr("id","enp-mc-option--"+n),e("input",t).each(function(){var n=e(this).prop("name"),o=/\[mc_option\]\[(.*?)\]/,t=n.match(o)[1],i=parseInt(t)+1;new_inputName=n.replace(o,"[mc_option]["+i+"]"),e(this).attr("name",new_inputName)}),e(s).before(t),e("#enp-mc-option--"+n+" .enp-input").focus()}function q(e,n){for(var o in n)if(console.log(n[o]),parseInt(n[o].question_id)===parseInt(e)){console.log("found question.");for(var t in n[o].mc_option)if(console.log(n[o].mc_option[t]),"insert"===n[o].mc_option[t].action)return n[o].mc_option[t].mc_option_id}return!1}function v(e,n){for(var o in n)if(parseInt(n[o].question_id)===parseInt(e))return console.log(n[o]),n[o];return!1}function g(e,n){for(var o in n)for(var t in n[o].mc_option)if(parseInt(n[o].mc_option[t].mc_option_id)===parseInt(e))return n[o].mc_option[t];return!1}e(".enp-question-content").each(function(){var n,o,t;o=e(".enp-question-title__textarea",this).val(),(void 0===o||""===o)&&(o="Untitled"),t=e(this),n={title:o,content:t,baseID:e(this).attr("id")},n=enp_accordion__create_headers(n),enp_accordion__setup(n)}),e(document).on("keyup",".enp-question-title__textarea",function(){question_title=e(this).val(),e(this).closest(".enp-question-content").prev(".enp-accordion-header").text(question_title)}),e(document).on("click",".enp-quiz-submit",function(o){if(!e(this).hasClass("enp-btn--next-step")){if(o.preventDefault(),e(this).hasClass("enp-question__button--delete")){var s=confirm("Are you sure you want to delete this question?");if(s===!1)return!1}if(e(this).hasClass("enp-quiz-submit--wait"))return console.log("waiting..."),!1;i();var a=e(this).val();t(a),n(a)}}),e("#enp-quiz").append('<section class="enp-quiz-message-ajax-container"></section>')});