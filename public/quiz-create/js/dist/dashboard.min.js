jQuery(document).ready(function(e){function t(t){t.addClass("enp-dash-item--menu-active"),e(".enp-dash-item__menu-action",t).attr("aria-expanded",!0),e(".enp-dash-item__nav",t).attr("aria-hidden",!1)}function n(t){t.removeClass("enp-dash-item--menu-active"),e(".enp-dash-item__menu-action",t).attr("aria-expanded",!1),e(".enp-dash-item__nav",t).attr("aria-hidden",!0)}function s(t,n,s){if(void 0===s.responseJSON)return _(),m("Something went wrong. Please reload the page and try again.","error"),!1;t=e.parseJSON(s.responseJSON),console.log(t),v(t.message);var i=t.user_action.action,a=t.user_action.element;if("success"===t.status&&"update"===t.action&&"delete"===i){if("quiz"===a){dashItem=e("#enp-dash-item--"+t.quiz_id);var o=c(t.user_action);o===!0&&l(t.user_action.secondary_action.ab_test_deleted)}else"ab_test"===a&&(dashItem=e("#enp-dash-item--"+t.ab_test_id+"a"+t.quiz_id_a+"b"+t.quiz_id_b));u(dashItem)}}function i(e,t){var n;return"delete-quiz"===t?n=a(e):"delete-ab-test"===t&&(n=o(e)),n}function a(t){var n=e(".enp-dash-item__quiz-id",t).val(),s=document.getElementById("enp-delete-quiz-"+n),i=new FormData(s);return i.append("enp-quiz-submit","delete-quiz"),i.append("action","save_quiz"),i}function o(t){var n=e(".enp-dash-item__ab-test-id",t).val(),s=e(".enp-dash-item__quiz-id-a",t).val(),i=e(".enp-dash-item__quiz-id-b",t).val(),a=document.getElementById("enp-delete-ab-test-"+n+"a"+s+"b"+i),o=new FormData(a);return o.append("enp-ab-test-submit","delete-ab-test"),o.append("action","save_ab_test"),o}function d(e){e.addClass("enp-dash-item--delete-wait"),e.append(r("enp-dash-item__spinner"))}function u(e){e.addClass("enp-dash-item--remove"),setTimeout(function(){e.remove()},300)}function c(e){var t=!1;for(var n in e)if("secondary_action"===n)for(var s in e.secondary_action)if("ab_test_deleted"===s)return t=!0;return t}function l(t){for(var n=0;n<t.length;n++)if("delete"===t[n].user_action.action&&"success"===t[n].status){var s=t[n].ab_test_id,i=t[n].quiz_id_a,a=t[n].quiz_id_b,o=e("#enp-dash-item--"+s+"a"+i+"b"+a);u(o)}}function r(e){return'<div class="spinner '+e+'"><div class="bounce bounce1"></div><div class="bounce bounce2"></div><div class="bounce bounce3"></div></div>'}function p(){e(".enp-quiz-submit").addClass("enp-quiz-submit--wait")}function _(){e(".enp-quiz-submit").removeClass("enp-quiz-submit--wait")}function m(t,n){var s=Math.floor(1e3*Math.random()+1);e(".enp-quiz-message-ajax-container").append('<div class="enp-quiz-message enp-quiz-message--ajax enp-quiz-message--'+n+" enp-container enp-message-"+s+'"><p class="enp-message__list enp-message__list--'+n+'">'+t+"</p></div>"),e(".enp-message-"+s).delay(3500).fadeOut(function(){e(".enp-message-"+s).fadeOut()})}function v(e){"undefined"!=typeof e.success&&e.success.length>0&&m(e.success[0],"success");for(var t=0;t<e.error.length;t++)m(e.error[t],"error")}e(".enp-quiz-list__view").prepend('<svg class="enp-view-toggle enp-view-toggle__grid enp-icon"><use xlink:href="#icon-grid"><title>Grid View</title></use></svg><svg class="enp-view-toggle enp-view-toggle__list enp-icon"><use xlink:href="#icon-list"><title>List View</title></use></svg>'),e(".enp-view-toggle__grid").addClass("enp-view-toggle__active"),e(document).on("click",".enp-view-toggle",function(){if(!e(this).hasClass("enp-view-toggle__active")){e(this).siblings(".enp-view-toggle").removeClass("enp-view-toggle__active"),e(this).addClass("enp-view-toggle__active");var t=e(this).parent().parent().next(".enp-dash-list");t.hasClass("enp-dash-list--list-view")?t.removeClass("enp-dash-list--list-view"):t.addClass("enp-dash-list--list-view")}}),e(".enp-dash-item__nav").each(function(){e(this).addClass("enp-dash-item__nav--collapsible").attr("aria-hidden",!0).before('<button class="enp-dash-item__menu-action" type="button" aria-expanded="false" aria-controls="'+e(this).attr("id")+'"><svg class="enp-dash-item__menu-action__icon enp-dash-item__menu-action__icon--bottom"><use xlink:href="#icon-chevron-down" /></svg><svg class="enp-dash-item__menu-action__icon enp-dash-item__menu-action__icon--top"><use xlink:href="#icon-chevron-down" /></svg></button>')}),e(document).on("click",".enp-dash-item__menu-action",function(){var s=e(this).closest(".enp-dash-item");if(s.hasClass("enp-dash-item--menu-active"))n(s);else{var i=e(".enp-dash-item--menu-active");0<i.length&&n(i),t(s),e(".enp-dash-item__nav__item:eq(0) a",s).focus()}}),e(".enp-dash-item__delete").click(function(t){t.preventDefault();var n=e(this).closest(".enp-dash-item"),a=e(this).val();"delete-quiz"===a?confirmDeleteText="Are you sure you want to delete this quiz? This will also delete any AB Tests you have set-up with this Quiz.":"delete-ab-test"===a?confirmDeleteText="Are you sure you want to delete this AB Test?":alert("Something went wrong. Please send us an email telling us how you reached this error message");var o=confirm(confirmDeleteText);if(o===!1)return!1;if(e(this).hasClass("enp-quiz-submit--wait"))return!1;p(),d(n);var u=i(n,a);e.ajax({type:"POST",url:quizDashboard.ajax_url,data:u,processData:!1,contentType:!1}).done(s).fail(function(e,t,n){console.log("AJAX failed",e.getAllResponseHeaders(),t,n)}).then(function(e,t,n){}).always(function(){_()})}),e(".enp-quiz-message--welcome").length&&e(".enp-quiz-message--welcome").append('<button class="enp-quiz-message__close" type="button"><svg class="enp-quiz-message__close__icon enp-icon"><use xlink:href="#icon-close" /></svg></button>'),e(document).on("click",".enp-quiz-message__close",function(){e(this).closest(".enp-quiz-message--welcome").remove()}),e("#enp-quiz").append('<section class="enp-quiz-message-ajax-container" aria-live="assertive"></section>')});