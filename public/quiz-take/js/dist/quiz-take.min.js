jQuery(document).ready(function(e){function t(){height=n(),console.log("sending body height of "+height),json='{"quiz_id":"'+z()+'","height":"'+height+'"}',parent.postMessage(json,"*")}function n(){var t=document.getElementById("enp-quiz-container").offsetHeight;if(e(".enp-option__input--slide-hide").length){var n=0;e(".enp-option__input--slide-hide").each(function(){var t=e(this).next(".enp-option__label");n+=t.outerHeight(!0)}),t-=n}return t+"px"}function o(e){return"string"!=typeof e.data?!1:(data=_.is_json_string(e.data),void(data!==!1&&"undefined"!==data.height&&/([0-9]px)/.test(data.height)||t()))}function i(n,o,i){e(".enp-question__submit").remove();var s=e.parseJSON(i.responseText);"question"===s.next_state&&a(s.next_question),t()}function s(t){e("#question_"+t.question_id).data("questionJSON",t)}function a(t){var n={question_id:t.question_id,question_type:t.question_type,question_title:t.question_title};if(new_questionTemplate=b(n),e(".enp-question__fieldset").before(new_questionTemplate),e("#question_"+t.question_id).addClass("enp-question--on-deck"),s(t),""!==t.question_image){var o={question_image_src:t.question_image_src,question_image_srcset:t.question_image_srcset,question_image_alt:t.question_image_alt};new_questionImageTemplate=O(o),e("#question_"+t.question_id+" .enp-question__question").after(new_questionImageTemplate)}if("mc"===t.question_type){for(var i in t.mc_option)mc_option_id=t.mc_option[i].mc_option_id,mc_option_content=t.mc_option[i].mc_option_content,mcOptionData={mc_option_id:mc_option_id,mc_option_content:mc_option_content},new_mcOption=w(mcOptionData),e("#question_"+t.question_id+" .enp-question__submit").before(new_mcOption);g(t)}else"slider"===t.question_type}function u(t){questionNumber=parseInt(t)+1,totalQuestions=_.get_total_questions(),progressBarWidth=questionNumber/totalQuestions*100,100===progressBarWidth&&(progressBarWidth=95),progressBarWidth+="%",e(".enp-quiz__progress__bar__question-count__current-number").text(questionNumber),e(".enp-quiz__progress__bar").css("width",progressBarWidth)}function r(e){e.addClass("enp-question--show").removeClass("enp-question--on-deck"),questionShowJSON=e.data("questionJSON"),questionOrder=questionShowJSON.question_order,u(questionOrder)}function p(t){return userAction=t.attr("name")+"="+t.val(),doing_ajax="doing_ajax=doing_ajax",data=e(".enp-question__form").serialize()+"&"+userAction+"&"+doing_ajax,data}function c(e,t,n){console.log("generating explanation"),_.is_last_question(e)===!0?question_next_step_text="View Results":question_next_step_text="Next Question";var o=e["question_responses_"+t+"_percentage"];return o=_.reformat_number(o,100),explanationTemplate=y({question_id:e.question_id,question_explanation:e.question_explanation,question_explanation_title:t,question_explanation_percentage:o,question_next_step_text:question_next_step_text}),"function"==typeof n&&n(explanation),explanationTemplate}function l(n,o,i){var s=e.parseJSON(i.responseText);console.log(s),"quiz_end"===s.state?(qEndTemplate=h(s.quiz_end),e(".enp-question__form").append(qEndTemplate),e(".enp-results").addClass(".enp-question--on-deck").addClass("enp-question--show").removeClass("enp-question--on-deck"),e(".enp-quiz__progress__bar").css("width","100%"),e(".enp-quiz__progress__bar__question-count__total-questions").append(" Correct"),e(".enp-quiz__progress__bar__question-count__current-number").text(s.quiz_end.score_total_correct),e("#enp-results__score__circle__path").attr("class","enp-results__score__circle__resetOffset"),animateScoreID=window.setTimeout(x,250)):"question"===s.state&&(e(".enp-question--show").length||(a(s.next_question),nextQuestion=e(".enp-question--on-deck"),r(nextQuestion))),e(".enp-question__answered").remove(),t()}function d(t,n){var o;return e(".enp-option__input",t).each(function(t,i){return"1"===e(this).data("correct")?(o=e(this),"function"==typeof n&&n(e(this)),!1):void 0}),o}function q(t,n){var o;return e(".enp-option__input",t).each(function(t,i){"0"===e(this).data("correct")&&(o=e(this),"function"==typeof n&&n(e(this)))}),o}function m(e){e.hasClass("enp-option__input--incorrect-clicked")||e.addClass("enp-option__input--slide-hide")}function f(e){e.addClass("enp-option__input--correct")}function g(t){if("mc"===t.question_type)for(var n in t.mc_option)mc_option_id=t.mc_option[n].mc_option_id,mc_option_correct=t.mc_option[n].mc_option_correct,e("#enp-option__"+mc_option_id).data("correct",mc_option_correct)}function h(e,t){return quizEndData={score_percentage:e.score_percentage,score_circle_dashoffset:e.score_circle_dashoffset,quiz_end_title:e.quiz_end_title,quiz_end_content:e.quiz_end_content},qEndTemplate=j(quizEndData),"function"==typeof t&&t(explanation),qEndTemplate}function x(){e("#enp-results__score__circle__path").attr("class","enp-results__score__circle__setOffset")}function v(t){e("#quiz").data("quizJSON",t)}function z(){return json=e("#quiz").data("quizJSON"),json.quiz_id}if(_.reformat_number=function(e,t,n){return""===t&&(t=1),""===n&&(n=0),e*=t,e=e.toFixed(n)},_.is_last_question=function(e){return questionNumber=parseInt(e.question_order)+1,totalQuestions=_.get_total_questions(),console.log(questionNumber),console.log(totalQuestions),questionNumber===totalQuestions?!0:!1},_.get_total_questions=function(){return quizJSON=e("#quiz").data("quizJSON"),quizJSON.questions.length},_.is_json_string=function(e){try{json=JSON.parse(e)}catch(t){return!1}return json},_.templateSettings={interpolate:/\{\{(.+?)\}\}/g},e("#question_template").length)var b=_.template(e("#question_template").html()),w=_.template(e("#mc_option_template").html()),O=_.template(e("#question_image_template").html());if(e("#question_explanation_template").length)var y=_.template(e("#question_explanation_template").html());if(e("#quiz_end_template").length)var j=_.template(e("#quiz_end_template").html());window.addEventListener("message",o,!1),e(document).on("click",".enp-option__label",function(t){if(!e(".enp-question__container--unanswered").length)return!1;var n=e(this).prev(".enp-option__input");n.prop("checked")||n.prop("checked",!0),e(".enp-question__submit").trigger("click")}),e(document).on("click",".enp-question__submit",function(t){t.preventDefault(),e(".enp-question__container").addClass("enp-question__container--explanation").removeClass("enp-question__container--unanswered");var n=e(".enp-option__input:checked"),o=n.data("correct");"1"===o?(correct_string="correct",n.addClass("enp-option__input--correct-clicked"),f(n)):(correct_string="incorrect",n.addClass("enp-option__input--incorrect-clicked"),correctInput=d(e(".enp-question__fieldset"),f)),q(e(".enp-question__fieldset"),m);var s=e(this).closest(".enp-question__fieldset").data("questionJSON");e(this).closest(".enp-question__fieldset").addClass("enp-question__answered");var _=c(s,correct_string);e(".enp-question__submit").before(_),data=p(e(this)),url=e(".enp-question__form").attr("action"),e.ajax({type:"POST",url:url,data:data,dataType:"json"}).done(i).fail(function(e,t,n){console.log("AJAX failed",e.getAllResponseHeaders(),t,n)}).then(function(e,t,n){console.log("AJAX after finished")}).always(function(){})}),e(document).on("click",".enp-next-step",function(t){t.preventDefault(),url=e(".enp-question__form").attr("action"),data=p(e(this)),e(".enp-question__answered").addClass("enp-question--remove"),e(".enp-question__container").removeClass("enp-question__container--explanation").addClass("enp-question__container--unanswered"),e(".enp-question--on-deck").length&&(nextQuestion=e(".enp-question--on-deck"),r(nextQuestion)),e.ajax({type:"POST",url:url,data:data,dataType:"json"}).done(l).fail(function(e,t,n){console.log("AJAX failed",e.getAllResponseHeaders(),t,n)}).then(function(e,t,n){console.log("AJAX after finished")}).always(function(){})}),"undefined"!=typeof init_question_json&&(s(init_question_json),g(init_question_json)),v(quiz_json),t()});