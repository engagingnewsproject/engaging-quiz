jQuery(document).ready(function(a){var l,d,u,c,t,p,n,r,o,e;function s(e,t){json=(e=e,t=t,e={quiz_id:_.get_quiz_id(),ab_test_id:_.get_ab_test_id(),action:e},"object"==typeof t&&null!==t&&(e=Object.assign(e,t)),JSON.stringify(e)),parent.postMessage(json,"*"),json}function m(){s("setHeight",{height:bodyHeight=(()=>{var t,e=document.getElementById("enp-quiz-container").offsetHeight+document.getElementById("enp-quiz-footer").offsetHeight;return a(".enp-option__input--slide-hide").length&&(t=0,a(".enp-option__input--slide-hide").each(function(){var e=a(this).next(".enp-option__label");t+=e.outerHeight(!0)}),e-=t),e+"px"})()})}function i(){s("saveSite")}function q(e,t,n){a(".enp-question__submit").remove();n=void 0!==n.responseJSON?n.responseJSON:JSON.parse(n.responseText);n.error.length?_.handle_error_message(n.error[0]):"question"===n.next_state&&h(n.next_question),a("#correctly-answered").val(n.correctly_answered),m()}function g(e){a("#question_"+e.question_id).data("questionJSON",e)}function h(e){if(!(0<a("#question_"+e.question_id).length)){var t,n={question_id:e.question_id,question_type:e.question_type,question_title:e.question_title};if(new_questionTemplate=l(n),a(".enp-question__fieldset").before(new_questionTemplate),a("#question_"+e.question_id).addClass("enp-question--on-deck").attr("aria-hidden",!0),g(e),""!==e.question_image&&(t={question_image_src:(n=e).question_image_src,question_image_srcset:n.question_image_srcset,question_image_alt:n.question_image_alt},new_questionImageTemplate=p(t),a("#question_"+n.question_id+" .enp-question__question").after(new_questionImageTemplate)),"mc"===e.question_type){var i,r,o,s=e;for(o in s.mc_option)mc_option_id=s.mc_option[o].mc_option_id,mc_option_content=s.mc_option[o].mc_option_content,i=s.mc_option[o].mc_option_image_src,r={mc_option_id:mc_option_id,mc_option_content:mc_option_content},i&&(r.mc_option_image_src=i),new_mcOption=(!i&&u||d)(r),a("#question_"+s.question_id+" .enp-question__submit").before(new_mcOption);z(s)}else"slider"===e.question_type&&(sliderJSON=(t=e).slider,sliderData={slider_id:sliderJSON.slider_id,slider_range_low:sliderJSON.slider_range_low,slider_range_high:sliderJSON.slider_range_high,slider_correct_low:sliderJSON.slider_correct_low,slider_correct_high:sliderJSON.slider_correct_high,slider_increment:sliderJSON.slider_increment,slider_start:sliderJSON.slider_start,slider_prefix:sliderJSON.slider_prefix,slider_suffix:sliderJSON.slider_suffix,slider_input_size:sliderJSON.slider_range_high.length},slider=c(sliderData),a("#question_"+t.question_id+" .enp-question__submit").before(slider),O(t))}}function f(e){var t;e.addClass("enp-question--show").removeClass("enp-question--on-deck").attr("aria-hidden",!1),questionShowJSON=e.data("questionJSON"),questionOrder=questionShowJSON.question_order,t=questionOrder,questionNumber=parseInt(t)+1,totalQuestions=_.get_total_questions(),100===(progressBarWidth=questionNumber/totalQuestions*100)&&(progressBarWidth=95),progressBarWidth+="%",a(".enp-quiz__progress__bar__question-count__current-number").text(questionNumber),a(".enp-quiz__progress__bar").attr("aria-valuetext",a(".enp-quiz__progress__bar__question-count").text()),a(".enp-quiz__progress__bar").attr("aria-valuenow",a(".enp-quiz__progress__bar__question-count__current-number").text()),a(".enp-quiz__progress__bar").css("width",progressBarWidth),a(".enp-question__question",e).focus()}function w(e){return userAction=e.attr("name")+"="+e.val(),doing_ajax="doing_ajax=doing_ajax",data=a(".enp-question__form").serialize()+"&"+userAction+"&"+doing_ajax,!0!==(questionPattern=new RegExp("&enp-question-response=")).test(data)&&(data+="&enp-question-response="+a('.enp-question__form input[name="enp-question-response"]').val()),data}function v(e,t,n){var i,n=void 0!==n.responseJSON?n.responseJSON:JSON.parse(n.responseText);n.error.length&&_.handle_error_message(n.error[0]),"quiz_end"===n.state?(qEndTemplate=((e,t)=>(quizEndData={score_percentage:e.score_percentage,score_circle_dashoffset:e.score_circle_dashoffset,quiz_end_title:e.quiz_end_title,quiz_end_content:e.quiz_end_content},qEndTemplate=o(quizEndData),"function"==typeof t&&t(explanation),qEndTemplate))(n.quiz_end),a(".enp-question__form").append(qEndTemplate),a(".enp-results").addClass("enp-question--on-deck").addClass("enp-question--show").removeClass("enp-question--on-deck"),a(".enp-quiz__progress__bar").css("width","100%"),a(".enp-quiz__progress__bar__question-count__total-questions").append(" Correct"),a(".enp-quiz__progress__bar__question-count__current-number").text(n.quiz_end.correctly_answered),i=a(".enp-quiz__progress__bar__question-count").text(),a(".enp-quiz__progress__bar").attr("aria-valuetext","Quiz Complete. "+i+"."),a("#enp-results__score__circle__path").attr("class","enp-results__score__circle__resetOffset"),animateScoreID=window.setTimeout(C,250)):"question"!==n.state||a(".enp-question--show").length||(h(n.next_question),f(nextQuestion=a(".enp-question--on-deck"))),a(".enp-question__answered").remove(),m(),s("scrollToQuiz")}function x(e){e.hasClass("enp-option__input--incorrect-clicked")||e.addClass("enp-option__input--slide-hide")}function b(e){e.addClass("enp-option__input--correct")}function z(e){for(var t in e.mc_option)mc_option_id=e.mc_option[t].mc_option_id,mc_option_correct=e.mc_option[t].mc_option_correct,a("#enp-option__"+mc_option_id).data("correct",mc_option_correct)}function O(e){var n;question=a("#question_"+e.question_id),(sliderInput=a(".enp-slider-input__input",question)).data("sliderJSON",e.slider),n=sliderInput,e=e.slider,(slider=a('<div class="enp-slider" aria-hidden="true" role="presentation"></div>')).data("sliderID",e.slider_id),a(n).data("sliderID",e.slider_id),a(slider).slider({range:"min",value:parseFloat(e.slider_start),min:parseFloat(e.slider_range_low),max:parseFloat(e.slider_range_high),step:parseFloat(e.slider_increment),slide:function(e,t){a(n).val(t.value)}}),(sliderInputContainer=a(n).parent()).after(slider),sliderTakeRangeHelpers=t({slider_range_low:parseFloat(e.slider_range_low),slider_range_high:parseFloat(e.slider_range_high)}),sliderInputContainer.append(sliderTakeRangeHelpers)}function S(e,t){var n;return a(".enp-slider").each(function(){if(a(this).data("sliderID")===e)return n=a(this),"function"==typeof t&&t(a(this)),!1}),n}function C(){a("#enp-results__score__circle__path").attr("class","enp-results__score__circle__setOffset")}_.reformat_number=function(e,t,n){return e=(e*=t=""===t?1:t).toFixed(n=""===n?0:n)},_.is_last_question=function(e){return questionNumber=parseInt(e.question_order)+1,totalQuestions=_.get_total_questions(),questionNumber===totalQuestions},_.get_total_questions=function(){return(quizJSON=a("#quiz").data("quizJSON")).questions.length},_.is_json_string=function(e){try{json=JSON.parse(e)}catch(e){return!1}return json},_.get_quiz_id=function(){return(json=a("#quiz").data("quizJSON")).quiz_id},_.get_ab_test_id=function(){return ab_test_id_json.ab_test_id},_.handle_error_message=function(e){errorMessage=n({error:e}),a(".enp-question__fieldset").remove(),a(".enp-question__container").addClass("enp-question__container--error"),a(".enp-question__container").prepend(errorMessage),a(".enp-quiz-message--error a, .enp-quiz-message--error button").focus()},_.add_event=function(e,t,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t[e]=n},_.rawurlencode=function(e){return e+="",encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")},_.replaceURLs=function(e,t,n){return e.replace(t,n).replace(encodeURIComponent(t),encodeURIComponent(n)).replace(_.rawurlencode(t),_.rawurlencode(n))},_.templateSettings={interpolate:/\{\{(.+?)\}\}/g},a("#question_template").length&&(l=_.template(a("#question_template").html()),d=_.template(a("#mc_option_template").html()),u=a("#mc_option_text_template").length?_.template(a("#mc_option_text_template").html()):null,c=_.template(a("#slider_template").html()),t=_.template(a("#slider_range_helpers_template").html()),p=_.template(a("#question_image_template").html()),n=_.template(a("#error_message_template").html())),a("#question_explanation_template").length&&(r=_.template(a("#question_explanation_template").html())),a("#quiz_end_template").length&&(o=_.template(a("#quiz_end_template").html())),quiz_json.quiz_options.facebook_title_end&&_.template(quiz_json.quiz_options.facebook_title_end),quiz_json.quiz_options.facebook_description_end&&_.template(quiz_json.quiz_options.facebook_description_end),a(document).on("click",".enp-option__image-expand",function(e){e.preventDefault(),e.stopPropagation();var e=a(this).attr("data-enp-expand-src"),t=a("#enp-option-image-modal"),n=t.find(".enp-option-image-modal__img"),i=a(this).closest(".enp-option__image-wrap").find(".enp-option__image").attr("alt")||"";e&&(n.attr({src:e,alt:i}),t.removeAttr("hidden"))}),a(document).on("click",".enp-option-image-modal__backdrop, .enp-option-image-modal__close",function(){a("#enp-option-image-modal").attr("hidden","hidden")}),a(document).on("keydown",function(e){"Escape"===e.key&&a("#enp-option-image-modal").length&&!a("#enp-option-image-modal").attr("hidden")&&a("#enp-option-image-modal").attr("hidden","hidden")}),_.add_event("message",window,function(e){if("string"!=typeof e.data)return!1;"request"===(data=_.is_json_string(e.data)).status&&("sendBodyHeight"===data.action?m():"setShareURL"===data.action?((e=>{var t=window.location.href;(a(".enp-results__share__link").length?(t,n)=>{a(".enp-results__share__link").each(function(){var e=a(this).attr("href"),e=_.replaceURLs(e,t,n);a(this).attr("href",e)})}:(e,t)=>{var n=a("#quiz_end_template"),i=n.text(),i=_.replaceURLs(i,e,t);n.text(i),o=_.template(n.html())})(t,e)})(data.parentURL),(e=>{var t,n;n=a(".enp-callout__link"),t=n.attr("href"),!1===/iframe_parent_url/.test(t)&&(t+="&iframe_parent_url="+e,n.attr("href",t))})(data.parentURL)):"sendSaveSite"===data.action&&i())}),a(document).on("click",".enp-option__label",function(e){if(!a(".enp-question__container--unanswered").length)return!1;var t=a(this).prev(".enp-option__input");t.prop("checked")||t.prop("checked",!0),a(".enp-question__submit").trigger("click")}),a(document).on("click",".enp-question__submit",function(e){e.preventDefault();e=a(this).closest(".enp-question__fieldset").data("questionJSON");if("mc"===e.question_type?correct_string=(()=>{var e=a(".enp-option__input:checked");{var t,n;return 0===e.length?(console.log("no selected options"),!1):(t=e.data("correct"),1===Number(t)?(correct_string="correct",e.addClass("enp-option__input--correct-clicked"),b(e)):(correct_string="incorrect",e.addClass("enp-option__input--incorrect-clicked"),correctInput=((e,n)=>{var i;return a(".enp-option__input",e).each(function(e,t){if(1===Number(a(this).data("correct")))return i=a(this),"function"==typeof n&&n(a(this)),!1}),i})(a(".enp-question__fieldset"),b)),t=a(".enp-question__fieldset"),n=x,a(".enp-option__input",t).each(function(e,t){0===Number(a(this).data("correct"))&&(a(this),"function"==typeof n)&&n(a(this))}),correct_string)}})():"slider"===e.question_type&&(questionFieldset=a(this).parent(),correct_string=(e=>(sliderInput=a(".enp-slider-input__input",e),slider=a(".enp-slider",e),sliderInput.attr("disabled","disabled"),slider.slider("disable"),sliderSubmittedVal=parseFloat(sliderInput.val()),sliderJSON=sliderInput.data("sliderJSON"),sliderCorrectLow=parseFloat(sliderJSON.slider_correct_low),sliderCorrectHigh=parseFloat(sliderJSON.slider_correct_high),correct_string=sliderCorrectLow<=sliderSubmittedVal&&sliderSubmittedVal<=sliderCorrectHigh?"correct":"incorrect",sliderInput.addClass("enp-slider-input__input--"+correct_string),a(".ui-slider-range-min",e).addClass("ui-slider-range-min--"+correct_string),a(".ui-slider-handle",e).addClass("ui-slider-handle--"+correct_string),"incorrect"!==correct_string&&sliderCorrectLow===sliderCorrectHigh||(a(".enp-slider-input__range-helper__number").hide(),a(".ui-slider-range-min",e).after('<div class="ui-slider-range-show-correct ui-slider-range"></div>'),sliderRangeLow=parseFloat(sliderJSON.slider_range_low),sliderRangeHigh=parseFloat(sliderJSON.slider_range_high),sliderIncrement=parseFloat(sliderJSON.slider_increment),sliderTotalIntervals=(sliderRangeHigh-sliderRangeLow)/sliderIncrement,correctLowIntervals=(sliderCorrectLow-sliderRangeLow)/sliderIncrement,correctHighIntervals=(sliderCorrectHigh-sliderRangeLow)/sliderIncrement,correctLowOffsetLeft=correctLowIntervals/sliderTotalIntervals*100,correctHighOffsetLeft=correctHighIntervals/sliderTotalIntervals*100,correctRangeWidth=correctHighOffsetLeft-correctLowOffsetLeft,a(".ui-slider-range-show-correct",e).css({width:correctRangeWidth+"%",left:correctLowOffsetLeft+"%"}).text(sliderJSON.sliderCorrectLow),toolTipHTML='<div class="ui-slider-range-show-correct__tooltip ui-slider-range-show-correct__tooltip--low"><span class="ui-slider-range-show-correct__tooltip__text ui-slider-range-show-correct__tooltip__text--low">'+sliderCorrectLow+"</span></div>",sliderCorrectLow!==sliderCorrectHigh&&(toolTipHTML+='<div class="ui-slider-range-show-correct__tooltip ui-slider-range-show-correct__tooltip--high"><span class="ui-slider-range-show-correct__tooltip__text ui-slider-range-show-correct__tooltip__text--high">'+sliderCorrectHigh+"</span></div>"),a(".ui-slider-range-show-correct",e).append('<div class="ui-slider-range-show-correct__tooltip-container">'+toolTipHTML+"</div>"),sliderCorrectLow===sliderCorrectHigh&&a(".ui-slider-range-show-correct__tooltip__text--low",e).addClass("ui-slider-range-show-correct__tooltip__text--low-center")),correct_string))(questionFieldset)),"correct"!==correct_string&&"incorrect"!==correct_string)return!1;a(".enp-question__container").addClass("enp-question__container--explanation").removeClass("enp-question__container--unanswered"),a(this).closest(".enp-question__fieldset").addClass("enp-question__answered");e=((e,t,n)=>{if(0<a("#enp-explanation_"+e.question_id).length)return!1;question_next_step_text=!0===_.is_last_question(e)?"View Results":"Next Question";var i=e["question_responses_"+t+"_percentage"];return i=_.reformat_number(i,100),explanationTemplate=r({question_id:e.question_id,question_explanation:e.question_explanation,question_explanation_title:t,question_explanation_percentage:i,question_next_step_text:question_next_step_text}),"function"==typeof n&&n(explanationTemplate),explanationTemplate})(e,correct_string);a(".enp-question__submit").before(e),a(".enp-next-step").focus(),data=w(a(this)),url=a(".enp-question__form").attr("action"),a.ajax({type:"POST",url:url,data:data,dataType:"json"}).done(q).fail(function(e,t,n){console.log("AJAX failed",e.getAllResponseHeaders(),t,n)}).then(function(e,t,n){}).always(function(){})}),a(document).on("click",".enp-next-step",function(e){e.preventDefault(),url=a(".enp-question__form").attr("action"),data=w(a(this)),a(".enp-question__answered").addClass("enp-question--remove"),a(".enp-question__container").removeClass("enp-question__container--explanation").addClass("enp-question__container--unanswered"),a(".enp-question--on-deck").length&&f(nextQuestion=a(".enp-question--on-deck")),a.ajax({type:"POST",url:url,data:data,dataType:"json"}).done(v).fail(function(e,t,n){console.log("AJAX failed",e.getAllResponseHeaders(),t,n)}).then(function(e,t,n){}).always(function(){})}),a(document).on("input",".enp-slider-input__input",function(){var e=S(a(this).data("sliderID")),t=a(this).val();e.slider("value",t),sliderVal=e.slider("value")}),a(document).on("blur",".enp-slider-input__input",function(){var e,t;input=a(this),t=S(a(this).data("sliderID")),e=input.val(),t=t.slider("value"),parseInt(t)!==parseInt(e)&&(input.val(t),input.addClass("enp-slider-input__input--invalid-animation"),setTimeout(function(){input.removeClass("enp-slider-input__input--invalid-animation")},500))}),a(document).on("click",".enp-quiz-restart",function(e){s("quizRestarted")}),"undefined"!=typeof init_question_json&&(g(init_question_json),"mc"===init_question_json.question_type?z(init_question_json):"slider"===init_question_json.question_type&&O(init_question_json)),e=quiz_json,a("#quiz").data("quizJSON",e),m(),s("sendURL"),i(),a(".enp-question-image").load(function(){m()})});