jQuery(document).ready(function(e){function t(e,t){var n,i;return n={quiz_id:_.get_quiz_id(),ab_test_id:_.get_ab_test_id(),action:e},"object"==typeof t&&null!==t&&(n=Object.assign(n,t)),i=JSON.stringify(n)}function n(e,n){return json=t(e,n),parent.postMessage(json,"*"),json}function i(){bodyHeight=o(),n("setHeight",{height:bodyHeight})}function r(){n("scrollToQuiz")}function o(){var t=document.getElementById("enp-quiz-container").offsetHeight+document.getElementById("enp-quiz-footer").offsetHeight;if(e(".enp-option__input--slide-hide").length){var n=0;e(".enp-option__input--slide-hide").each(function(){var t=e(this).next(".enp-option__label");n+=t.outerHeight(!0)}),t-=n}return t+"px"}function s(){n("sendURL")}function a(){n("saveSite")}function l(e){return"string"==typeof e.data&&(data=_.is_json_string(e.data),void("request"===data.status&&("sendBodyHeight"===data.action?i():"setShareURL"===data.action?(k(data.parentURL),u(data.parentURL)):"sendSaveSite"===data.action&&a())))}function u(t){var n,i;i=e(".enp-callout__link"),n=i.attr("href"),/iframe_parent_url/.test(n)===!1&&(n+="&iframe_parent_url="+t,i.attr("href",n))}function d(t,n,r){e(".enp-question__submit").remove();var o=e.parseJSON(r.responseText);o.error.length?_.handle_error_message(o.error[0]):"question"===o.next_state&&p(o.next_question),e("#correctly-answered").val(o.correctly_answered),i()}function c(t){e("#question_"+t.question_id).data("questionJSON",t)}function p(t){if(0<e("#question_"+t.question_id).length)return!1;var n={question_id:t.question_id,question_type:t.question_type,question_title:t.question_title};new_questionTemplate=D(n),e(".enp-question__fieldset").before(new_questionTemplate),e("#question_"+t.question_id).addClass("enp-question--on-deck").attr("aria-hidden",!0),c(t),""!==t.question_image&&m(t),"mc"===t.question_type?C(t):"slider"===t.question_type&&y(t)}function q(t){questionNumber=parseInt(t)+1,totalQuestions=_.get_total_questions(),progressBarWidth=questionNumber/totalQuestions*100,100===progressBarWidth&&(progressBarWidth=95),progressBarWidth+="%",e(".enp-quiz__progress__bar__question-count__current-number").text(questionNumber),e(".enp-quiz__progress__bar").attr("aria-valuetext",e(".enp-quiz__progress__bar__question-count").text()),e(".enp-quiz__progress__bar").attr("aria-valuenow",e(".enp-quiz__progress__bar__question-count__current-number").text()),e(".enp-quiz__progress__bar").css("width",progressBarWidth)}function g(t){t.addClass("enp-question--show").removeClass("enp-question--on-deck").attr("aria-hidden",!1),questionShowJSON=t.data("questionJSON"),questionOrder=questionShowJSON.question_order,q(questionOrder),e(".enp-question__question",t).focus()}function f(t){return userAction=t.attr("name")+"="+t.val(),doing_ajax="doing_ajax=doing_ajax",data=e(".enp-question__form").serialize()+"&"+userAction+"&"+doing_ajax,questionPattern=new RegExp("&enp-question-response="),questionPattern.test(data)!==!0&&(data+="&enp-question-response="+e('.enp-question__form input[name="enp-question-response"]').val()),data}function m(t){var n={question_image_src:t.question_image_src,question_image_srcset:t.question_image_srcset,question_image_alt:t.question_image_alt};new_questionImageTemplate=A(n),e("#question_"+t.question_id+" .enp-question__question").after(new_questionImageTemplate)}function h(t,n,i){if(0<e("#enp-explanation_"+t.question_id).length)return!1;_.is_last_question(t)===!0?question_next_step_text="View Results":question_next_step_text="Next Question";var r=t["question_responses_"+n+"_percentage"];return r=_.reformat_number(r,100),explanationTemplate=W({question_id:t.question_id,question_explanation:t.question_explanation,question_explanation_title:n,question_explanation_percentage:r,question_next_step_text:question_next_step_text}),"function"==typeof i&&i(explanationTemplate),explanationTemplate}function v(t,n,o){var s=e.parseJSON(o.responseText);if(s.error.length&&_.handle_error_message(s.error[0]),"quiz_end"===s.state){qEndTemplate=j(s.quiz_end),e(".enp-question__form").append(qEndTemplate),e(".enp-results").addClass("enp-question--on-deck").addClass("enp-question--show").removeClass("enp-question--on-deck"),e(".enp-quiz__progress__bar").css("width","100%"),e(".enp-quiz__progress__bar__question-count__total-questions").append(" Correct"),e(".enp-quiz__progress__bar__question-count__current-number").text(s.quiz_end.correctly_answered);var a=e(".enp-quiz__progress__bar__question-count").text();e(".enp-quiz__progress__bar").attr("aria-valuetext","Quiz Complete. "+a+"."),e("#enp-results__score__circle__path").attr("class","enp-results__score__circle__resetOffset"),animateScoreID=window.setTimeout(T,250)}else"question"===s.state&&(e(".enp-question--show").length||(p(s.next_question),nextQuestion=e(".enp-question--on-deck"),g(nextQuestion)));e(".enp-question__answered").remove(),i(),r()}function w(t,n){var i;return e(".enp-option__input",t).each(function(t,r){if("1"===e(this).data("correct"))return i=e(this),"function"==typeof n&&n(e(this)),!1}),i}function x(t,n){var i;return e(".enp-option__input",t).each(function(t,r){"0"===e(this).data("correct")&&(i=e(this),"function"==typeof n&&n(e(this)))}),i}function b(e){e.hasClass("enp-option__input--incorrect-clicked")||e.addClass("enp-option__input--slide-hide")}function z(e){e.addClass("enp-option__input--correct")}function O(t){for(var n in t.mc_option)mc_option_id=t.mc_option[n].mc_option_id,mc_option_correct=t.mc_option[n].mc_option_correct,e("#enp-option__"+mc_option_id).data("correct",mc_option_correct)}function C(t){for(var n in t.mc_option)mc_option_id=t.mc_option[n].mc_option_id,mc_option_content=t.mc_option[n].mc_option_content,mcOptionData={mc_option_id:mc_option_id,mc_option_content:mc_option_content},new_mcOption=E(mcOptionData),e("#question_"+t.question_id+" .enp-question__submit").before(new_mcOption);O(t)}function S(){var t=e(".enp-option__input:checked");if(0===t.length)return console.log("no selected options"),!1;var n=t.data("correct");return"1"===n?(correct_string="correct",t.addClass("enp-option__input--correct-clicked"),z(t)):(correct_string="incorrect",t.addClass("enp-option__input--incorrect-clicked"),correctInput=w(e(".enp-question__fieldset"),z)),x(e(".enp-question__fieldset"),b),correct_string}function I(t){question=e("#question_"+t.question_id),sliderInput=e(".enp-slider-input__input",question),sliderInput.data("sliderJSON",t.slider),N(sliderInput,t.slider)}function N(t,n){slider=e('<div class="enp-slider" aria-hidden="true" role="presentation"></div>'),slider.data("sliderID",n.slider_id),e(t).data("sliderID",n.slider_id),e(slider).slider({range:"min",value:parseFloat(n.slider_start),min:parseFloat(n.slider_range_low),max:parseFloat(n.slider_range_high),step:parseFloat(n.slider_increment),slide:function(n,i){e(t).val(i.value)}}),sliderInputContainer=e(t).parent(),sliderInputContainer.after(slider),sliderTakeRangeHelpers=U({slider_range_low:parseFloat(n.slider_range_low),slider_range_high:parseFloat(n.slider_range_high)}),sliderInputContainer.append(sliderTakeRangeHelpers)}function J(t,n){var i;return e(".enp-slider").each(function(){if(e(this).data("sliderID")===t)return i=e(this),"function"==typeof n&&n(e(this)),!1}),i}function y(t){sliderJSON=t.slider,sliderData={slider_id:sliderJSON.slider_id,slider_range_low:sliderJSON.slider_range_low,slider_range_high:sliderJSON.slider_range_high,slider_correct_low:sliderJSON.slider_correct_low,slider_correct_high:sliderJSON.slider_correct_high,slider_increment:sliderJSON.slider_increment,slider_start:sliderJSON.slider_start,slider_prefix:sliderJSON.slider_prefix,slider_suffix:sliderJSON.slider_suffix,slider_input_size:sliderJSON.slider_range_high.length},slider=Q(sliderData),e("#question_"+t.question_id+" .enp-question__submit").before(slider),I(t)}function L(t){return sliderInput=e(".enp-slider-input__input",t),slider=e(".enp-slider",t),sliderInput.attr("disabled","disabled"),slider.slider("disable"),sliderSubmittedVal=parseFloat(sliderInput.val()),sliderJSON=sliderInput.data("sliderJSON"),sliderCorrectLow=parseFloat(sliderJSON.slider_correct_low),sliderCorrectHigh=parseFloat(sliderJSON.slider_correct_high),sliderCorrectLow<=sliderSubmittedVal&&sliderSubmittedVal<=sliderCorrectHigh?correct_string="correct":correct_string="incorrect",sliderInput.addClass("enp-slider-input__input--"+correct_string),e(".ui-slider-range-min",t).addClass("ui-slider-range-min--"+correct_string),e(".ui-slider-handle",t).addClass("ui-slider-handle--"+correct_string),"incorrect"!==correct_string&&sliderCorrectLow===sliderCorrectHigh||(e(".enp-slider-input__range-helper__number").hide(),e(".ui-slider-range-min",t).after('<div class="ui-slider-range-show-correct ui-slider-range"></div>'),sliderRangeLow=parseFloat(sliderJSON.slider_range_low),sliderRangeHigh=parseFloat(sliderJSON.slider_range_high),sliderIncrement=parseFloat(sliderJSON.slider_increment),sliderTotalIntervals=(sliderRangeHigh-sliderRangeLow)/sliderIncrement,correctLowIntervals=(sliderCorrectLow-sliderRangeLow)/sliderIncrement,correctHighIntervals=(sliderCorrectHigh-sliderRangeLow)/sliderIncrement,correctLowOffsetLeft=correctLowIntervals/sliderTotalIntervals*100,correctHighOffsetLeft=correctHighIntervals/sliderTotalIntervals*100,correctRangeWidth=correctHighOffsetLeft-correctLowOffsetLeft,e(".ui-slider-range-show-correct",t).css({width:correctRangeWidth+"%",left:correctLowOffsetLeft+"%"}).text(sliderJSON.sliderCorrectLow),toolTipHTML='<div class="ui-slider-range-show-correct__tooltip ui-slider-range-show-correct__tooltip--low"><span class="ui-slider-range-show-correct__tooltip__text ui-slider-range-show-correct__tooltip__text--low">'+sliderCorrectLow+"</span></div>",sliderCorrectLow!==sliderCorrectHigh&&(toolTipHTML+='<div class="ui-slider-range-show-correct__tooltip ui-slider-range-show-correct__tooltip--high"><span class="ui-slider-range-show-correct__tooltip__text ui-slider-range-show-correct__tooltip__text--high">'+sliderCorrectHigh+"</span></div>"),e(".ui-slider-range-show-correct",t).append('<div class="ui-slider-range-show-correct__tooltip-container">'+toolTipHTML+"</div>"),sliderCorrectLow===sliderCorrectHigh&&e(".ui-slider-range-show-correct__tooltip__text--low",t).addClass("ui-slider-range-show-correct__tooltip__text--low-center")),correct_string}function j(e,t){return quizEndData={score_percentage:e.score_percentage,score_circle_dashoffset:e.score_circle_dashoffset,quiz_end_title:e.quiz_end_title,quiz_end_content:e.quiz_end_content},qEndTemplate=M(quizEndData),"function"==typeof t&&t(explanation),qEndTemplate}function T(){e("#enp-results__score__circle__path").attr("class","enp-results__score__circle__setOffset")}function k(t){var n=window.location.href;e(".enp-results__share__link").length?H(n,t):R(n,t)}function H(t,n){e(".enp-results__share__link").each(function(){var i=e(this).attr("href"),r=_.replaceURLs(i,t,n);e(this).attr("href",r)})}function R(t,n){var i=e("#quiz_end_template"),r=i.text(),o=_.replaceURLs(r,t,n);i.text(o),M=_.template(i.html())}function F(t){e("#quiz").data("quizJSON",t)}if(_.reformat_number=function(e,t,n){return""===t&&(t=1),""===n&&(n=0),e*=t,e=e.toFixed(n)},_.is_last_question=function(e){return questionNumber=parseInt(e.question_order)+1,totalQuestions=_.get_total_questions(),questionNumber===totalQuestions},_.get_total_questions=function(){return quizJSON=e("#quiz").data("quizJSON"),quizJSON.questions.length},_.is_json_string=function(e){try{json=JSON.parse(e)}catch(t){return!1}return json},_.get_quiz_id=function(){return json=e("#quiz").data("quizJSON"),json.quiz_id},_.get_ab_test_id=function(){return ab_test_id_json.ab_test_id},_.handle_error_message=function(t){errorMessage=B({error:t}),e(".enp-question__fieldset").remove(),e(".enp-question__container").addClass("enp-question__container--error"),e(".enp-question__container").prepend(errorMessage),e(".enp-quiz-message--error a, .enp-quiz-message--error button").focus()},_.add_event=function(e,t,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t[e]=n},_.rawurlencode=function(e){return e+="",encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")},_.replaceURLs=function(e,t,n){return e.replace(t,n).replace(encodeURIComponent(t),encodeURIComponent(n)).replace(_.rawurlencode(t),_.rawurlencode(n))},_.templateSettings={interpolate:/\{\{(.+?)\}\}/g},e("#question_template").length)var D=_.template(e("#question_template").html()),E=_.template(e("#mc_option_template").html()),Q=_.template(e("#slider_template").html()),U=_.template(e("#slider_range_helpers_template").html()),A=_.template(e("#question_image_template").html()),B=_.template(e("#error_message_template").html());if(e("#question_explanation_template").length)var W=_.template(e("#question_explanation_template").html());if(e("#quiz_end_template").length)var M=_.template(e("#quiz_end_template").html());if(quiz_json.quiz_options.facebook_title_end){_.template(quiz_json.quiz_options.facebook_title_end)}if(quiz_json.quiz_options.facebook_description_end){_.template(quiz_json.quiz_options.facebook_description_end)}_.add_event("message",window,l),e(document).on("click",".enp-option__label",function(t){if(!e(".enp-question__container--unanswered").length)return!1;var n=e(this).prev(".enp-option__input");n.prop("checked")||n.prop("checked",!0),e(".enp-question__submit").trigger("click")}),e(document).on("click",".enp-question__submit",function(t){t.preventDefault();var n=e(this).closest(".enp-question__fieldset").data("questionJSON");if("mc"===n.question_type?correct_string=S():"slider"===n.question_type&&(questionFieldset=e(this).parent(),correct_string=L(questionFieldset)),"correct"!==correct_string&&"incorrect"!==correct_string)return!1;e(".enp-question__container").addClass("enp-question__container--explanation").removeClass("enp-question__container--unanswered"),e(this).closest(".enp-question__fieldset").addClass("enp-question__answered");var i=h(n,correct_string);e(".enp-question__submit").before(i),e(".enp-next-step").focus(),data=f(e(this)),url=e(".enp-question__form").attr("action"),e.ajax({type:"POST",url:url,data:data,dataType:"json"}).done(d).fail(function(e,t,n){console.log("AJAX failed",e.getAllResponseHeaders(),t,n)}).then(function(e,t,n){}).always(function(){})}),e(document).on("click",".enp-next-step",function(t){t.preventDefault(),url=e(".enp-question__form").attr("action"),data=f(e(this)),e(".enp-question__answered").addClass("enp-question--remove"),e(".enp-question__container").removeClass("enp-question__container--explanation").addClass("enp-question__container--unanswered"),e(".enp-question--on-deck").length&&(nextQuestion=e(".enp-question--on-deck"),g(nextQuestion)),e.ajax({type:"POST",url:url,data:data,dataType:"json"}).done(v).fail(function(e,t,n){console.log("AJAX failed",e.getAllResponseHeaders(),t,n)}).then(function(e,t,n){}).always(function(){})}),e(document).on("input",".enp-slider-input__input",function(){var t,n,i;n=e(this).data("sliderID"),t=J(n),i=e(this).val(),t.slider("value",i),sliderVal=t.slider("value")}),e(document).on("blur",".enp-slider-input__input",function(){var t,n,i,r;input=e(this),n=e(this).data("sliderID"),t=J(n),i=input.val(),r=t.slider("value"),parseInt(r)!==parseInt(i)&&(input.val(r),input.addClass("enp-slider-input__input--invalid-animation"),setTimeout(function(){input.removeClass("enp-slider-input__input--invalid-animation")},500))}),e(document).on("click",".enp-quiz-restart",function(e){n("quizRestarted")}),"undefined"!=typeof init_question_json&&(c(init_question_json),"mc"===init_question_json.question_type?O(init_question_json):"slider"===init_question_json.question_type&&I(init_question_json)),F(quiz_json),i(),s(),a(),e(".enp-question-image").load(function(){i()})});