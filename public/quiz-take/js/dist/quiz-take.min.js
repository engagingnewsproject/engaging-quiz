jQuery(document).ready(function(q){if(_.reformat_number=function(e,t,n){return""===t&&(t=1),""===n&&(n=0),e=(e*=t).toFixed(n)},_.is_last_question=function(e){return questionNumber=parseInt(e.question_order)+1,totalQuestions=_.get_total_questions(),questionNumber===totalQuestions},_.get_total_questions=function(){return quizJSON=q("#quiz").data("quizJSON"),quizJSON.questions.length},_.is_json_string=function(e){try{json=JSON.parse(e)}catch(e){return!1}return json},_.get_quiz_id=function(){return json=q("#quiz").data("quizJSON"),json.quiz_id},_.get_ab_test_id=function(){return ab_test_id_json.ab_test_id},_.handle_error_message=function(e){errorMessage=t({error:e}),q(".enp-question__fieldset").remove(),q(".enp-question__container").addClass("enp-question__container--error"),q(".enp-question__container").prepend(errorMessage),q(".enp-quiz-message--error a, .enp-quiz-message--error button").focus()},_.add_event=function(e,t,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t[e]=n},_.rawurlencode=function(e){return e+="",encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")},_.replaceURLs=function(e,t,n){return e.replace(t,n).replace(encodeURIComponent(t),encodeURIComponent(n)).replace(_.rawurlencode(t),_.rawurlencode(n))},_.templateSettings={interpolate:/\{\{(.+?)\}\}/g},q("#question_template").length)var s=_.template(q("#question_template").html()),o=_.template(q("#mc_option_template").html()),a=_.template(q("#slider_template").html()),i=_.template(q("#slider_range_helpers_template").html()),l=_.template(q("#question_image_template").html()),t=_.template(q("#error_message_template").html());if(q("#question_explanation_template").length)var r=_.template(q("#question_explanation_template").html());if(q("#quiz_end_template").length)var g=_.template(q("#quiz_end_template").html());if(quiz_json.quiz_options.facebook_title_end)_.template(quiz_json.quiz_options.facebook_title_end);if(quiz_json.quiz_options.facebook_description_end)_.template(quiz_json.quiz_options.facebook_description_end);function u(e,t){var n,i,r;return json=(n=e,i=t,r={quiz_id:_.get_quiz_id(),ab_test_id:_.get_ab_test_id(),action:n},"object"==typeof i&&null!==i&&(r=Object.assign(r,i)),JSON.stringify(r)),parent.postMessage(json,"*"),json}function m(){bodyHeight=function(){var e=document.getElementById("enp-quiz-container").offsetHeight+document.getElementById("enp-quiz-footer").offsetHeight;if(q(".enp-option__input--slide-hide").length){var t=0;q(".enp-option__input--slide-hide").each(function(){var e=q(this).next(".enp-option__label");t+=e.outerHeight(!0)}),e-=t}return e+"px"}(),u("setHeight",{height:bodyHeight})}function h(){u("saveSite")}function d(e,t,n){q(".enp-question__submit").remove();var i=q.parseJSON(n.responseText);i.error.length?_.handle_error_message(i.error[0]):"question"===i.next_state&&p(i.next_question),q("#correctly-answered").val(i.correctly_answered),m()}function c(e){q("#question_"+e.question_id).data("questionJSON",e)}function p(e){if(0<q("#question_"+e.question_id).length)return!1;var t,n,i,r={question_id:e.question_id,question_type:e.question_type,question_title:e.question_title};new_questionTemplate=s(r),q(".enp-question__fieldset").before(new_questionTemplate),q("#question_"+e.question_id).addClass("enp-question--on-deck").attr("aria-hidden",!0),c(e),""!==e.question_image&&(n={question_image_src:(t=e).question_image_src,question_image_srcset:t.question_image_srcset,question_image_alt:t.question_image_alt},new_questionImageTemplate=l(n),q("#question_"+t.question_id+" .enp-question__question").after(new_questionImageTemplate)),"mc"===e.question_type?function(e){for(var t in e.mc_option)mc_option_id=e.mc_option[t].mc_option_id,mc_option_content=e.mc_option[t].mc_option_content,mcOptionData={mc_option_id:mc_option_id,mc_option_content:mc_option_content},new_mcOption=o(mcOptionData),q("#question_"+e.question_id+" .enp-question__submit").before(new_mcOption);b(e)}(e):"slider"===e.question_type&&(i=e,sliderJSON=i.slider,sliderData={slider_id:sliderJSON.slider_id,slider_range_low:sliderJSON.slider_range_low,slider_range_high:sliderJSON.slider_range_high,slider_correct_low:sliderJSON.slider_correct_low,slider_correct_high:sliderJSON.slider_correct_high,slider_increment:sliderJSON.slider_increment,slider_start:sliderJSON.slider_start,slider_prefix:sliderJSON.slider_prefix,slider_suffix:sliderJSON.slider_suffix,slider_input_size:sliderJSON.slider_range_high.length},slider=a(sliderData),q("#question_"+i.question_id+" .enp-question__submit").before(slider),z(i))}function f(e){var t;e.addClass("enp-question--show").removeClass("enp-question--on-deck").attr("aria-hidden",!1),questionShowJSON=e.data("questionJSON"),questionOrder=questionShowJSON.question_order,t=questionOrder,questionNumber=parseInt(t)+1,totalQuestions=_.get_total_questions(),progressBarWidth=questionNumber/totalQuestions*100,100===progressBarWidth&&(progressBarWidth=95),progressBarWidth+="%",q(".enp-quiz__progress__bar__question-count__current-number").text(questionNumber),q(".enp-quiz__progress__bar").attr("aria-valuetext",q(".enp-quiz__progress__bar__question-count").text()),q(".enp-quiz__progress__bar").attr("aria-valuenow",q(".enp-quiz__progress__bar__question-count__current-number").text()),q(".enp-quiz__progress__bar").css("width",progressBarWidth),q(".enp-question__question",e).focus()}function v(e){return userAction=e.attr("name")+"="+e.val(),doing_ajax="doing_ajax=doing_ajax",data=q(".enp-question__form").serialize()+"&"+userAction+"&"+doing_ajax,questionPattern=new RegExp("&enp-question-response="),!0!==questionPattern.test(data)&&(data+="&enp-question-response="+q('.enp-question__form input[name="enp-question-response"]').val()),data}function n(e,t,n){var i=q.parseJSON(n.responseText);if(i.error.length&&_.handle_error_message(i.error[0]),"quiz_end"===i.state){qEndTemplate=function(e,t){quizEndData={score_percentage:e.score_percentage,score_circle_dashoffset:e.score_circle_dashoffset,quiz_end_title:e.quiz_end_title,quiz_end_content:e.quiz_end_content},qEndTemplate=g(quizEndData),"function"==typeof t&&t(explanation);return qEndTemplate}(i.quiz_end),q(".enp-question__form").append(qEndTemplate),q(".enp-results").addClass("enp-question--on-deck").addClass("enp-question--show").removeClass("enp-question--on-deck"),q(".enp-quiz__progress__bar").css("width","100%"),q(".enp-quiz__progress__bar__question-count__total-questions").append(" Correct"),q(".enp-quiz__progress__bar__question-count__current-number").text(i.quiz_end.correctly_answered);var r=q(".enp-quiz__progress__bar__question-count").text();q(".enp-quiz__progress__bar").attr("aria-valuetext","Quiz Complete. "+r+"."),q("#enp-results__score__circle__path").attr("class","enp-results__score__circle__resetOffset"),animateScoreID=window.setTimeout(C,250)}else"question"===i.state&&(q(".enp-question--show").length||(p(i.next_question),nextQuestion=q(".enp-question--on-deck"),f(nextQuestion)));q(".enp-question__answered").remove(),m(),u("scrollToQuiz")}function w(e){e.hasClass("enp-option__input--incorrect-clicked")||e.addClass("enp-option__input--slide-hide")}function x(e){e.addClass("enp-option__input--correct")}function b(e){for(var t in e.mc_option)mc_option_id=e.mc_option[t].mc_option_id,mc_option_correct=e.mc_option[t].mc_option_correct,q("#enp-option__"+mc_option_id).data("correct",mc_option_correct)}function z(e){var n,t;question=q("#question_"+e.question_id),sliderInput=q(".enp-slider-input__input",question),sliderInput.data("sliderJSON",e.slider),n=sliderInput,t=e.slider,slider=q('<div class="enp-slider" aria-hidden="true" role="presentation"></div>'),slider.data("sliderID",t.slider_id),q(n).data("sliderID",t.slider_id),q(slider).slider({range:"min",value:parseFloat(t.slider_start),min:parseFloat(t.slider_range_low),max:parseFloat(t.slider_range_high),step:parseFloat(t.slider_increment),slide:function(e,t){q(n).val(t.value)}}),sliderInputContainer=q(n).parent(),sliderInputContainer.after(slider),sliderTakeRangeHelpers=i({slider_range_low:parseFloat(t.slider_range_low),slider_range_high:parseFloat(t.slider_range_high)}),sliderInputContainer.append(sliderTakeRangeHelpers)}function O(e,t){var n;return q(".enp-slider").each(function(){if(q(this).data("sliderID")===e)return n=q(this),"function"==typeof t&&t(q(this)),!1}),n}function C(){q("#enp-results__score__circle__path").attr("class","enp-results__score__circle__setOffset")}var e;_.add_event("message",window,function(e){if("string"!=typeof e.data)return!1;data=_.is_json_string(e.data),"request"===data.status&&("sendBodyHeight"===data.action?m():"setShareURL"===data.action?(r=data.parentURL,s=window.location.href,q(".enp-results__share__link").length?(c=s,p=r,q(".enp-results__share__link").each(function(){var e=q(this).attr("href"),t=_.replaceURLs(e,c,p);q(this).attr("href",t)})):(o=s,a=r,l=q("#quiz_end_template"),u=l.text(),d=_.replaceURLs(u,o,a),l.text(d),g=_.template(l.html())),t=data.parentURL,i=q(".enp-callout__link"),n=i.attr("href"),!1===/iframe_parent_url/.test(n)&&(n+="&iframe_parent_url="+t,i.attr("href",n))):"sendSaveSite"===data.action&&h());var t,n,i;var r,s,o,a,l,u,d,c,p}),q(document).on("click",".enp-option__label",function(e){if(!q(".enp-question__container--unanswered").length)return!1;var t=q(this).prev(".enp-option__input");t.prop("checked")||t.prop("checked",!0),q(".enp-question__submit").trigger("click")}),q(document).on("click",".enp-question__submit",function(e){e.preventDefault();var t=q(this).closest(".enp-question__fieldset").data("questionJSON");if("mc"===t.question_type?correct_string=function(){var e=q(".enp-option__input:checked");if(0===e.length)return console.log("no selected options"),!1;"1"===e.data("correct")?(correct_string="correct",e.addClass("enp-option__input--correct-clicked"),x(e)):(correct_string="incorrect",e.addClass("enp-option__input--incorrect-clicked"),correctInput=(t=q(".enp-question__fieldset"),n=x,q(".enp-option__input",t).each(function(e,t){if("1"===q(this).data("correct"))return i=q(this),"function"==typeof n&&n(q(this)),!1}),i));var t,n,i;return r=q(".enp-question__fieldset"),s=w,q(".enp-option__input",r).each(function(e,t){"0"===q(this).data("correct")&&(q(this),"function"==typeof s&&s(q(this)))}),correct_string;var r,s}():"slider"===t.question_type&&(questionFieldset=q(this).parent(),correct_string=function(e){sliderInput=q(".enp-slider-input__input",e),slider=q(".enp-slider",e),sliderInput.attr("disabled","disabled"),slider.slider("disable"),sliderSubmittedVal=parseFloat(sliderInput.val()),sliderJSON=sliderInput.data("sliderJSON"),sliderCorrectLow=parseFloat(sliderJSON.slider_correct_low),sliderCorrectHigh=parseFloat(sliderJSON.slider_correct_high),sliderCorrectLow<=sliderSubmittedVal&&sliderSubmittedVal<=sliderCorrectHigh?correct_string="correct":correct_string="incorrect";sliderInput.addClass("enp-slider-input__input--"+correct_string),q(".ui-slider-range-min",e).addClass("ui-slider-range-min--"+correct_string),q(".ui-slider-handle",e).addClass("ui-slider-handle--"+correct_string),("incorrect"===correct_string||sliderCorrectLow!==sliderCorrectHigh)&&(q(".enp-slider-input__range-helper__number").hide(),q(".ui-slider-range-min",e).after('<div class="ui-slider-range-show-correct ui-slider-range"></div>'),sliderRangeLow=parseFloat(sliderJSON.slider_range_low),sliderRangeHigh=parseFloat(sliderJSON.slider_range_high),sliderIncrement=parseFloat(sliderJSON.slider_increment),sliderTotalIntervals=(sliderRangeHigh-sliderRangeLow)/sliderIncrement,correctLowIntervals=(sliderCorrectLow-sliderRangeLow)/sliderIncrement,correctHighIntervals=(sliderCorrectHigh-sliderRangeLow)/sliderIncrement,correctLowOffsetLeft=correctLowIntervals/sliderTotalIntervals*100,correctHighOffsetLeft=correctHighIntervals/sliderTotalIntervals*100,correctRangeWidth=correctHighOffsetLeft-correctLowOffsetLeft,q(".ui-slider-range-show-correct",e).css({width:correctRangeWidth+"%",left:correctLowOffsetLeft+"%"}).text(sliderJSON.sliderCorrectLow),toolTipHTML='<div class="ui-slider-range-show-correct__tooltip ui-slider-range-show-correct__tooltip--low"><span class="ui-slider-range-show-correct__tooltip__text ui-slider-range-show-correct__tooltip__text--low">'+sliderCorrectLow+"</span></div>",sliderCorrectLow!==sliderCorrectHigh&&(toolTipHTML+='<div class="ui-slider-range-show-correct__tooltip ui-slider-range-show-correct__tooltip--high"><span class="ui-slider-range-show-correct__tooltip__text ui-slider-range-show-correct__tooltip__text--high">'+sliderCorrectHigh+"</span></div>"),q(".ui-slider-range-show-correct",e).append('<div class="ui-slider-range-show-correct__tooltip-container">'+toolTipHTML+"</div>"),sliderCorrectLow===sliderCorrectHigh&&q(".ui-slider-range-show-correct__tooltip__text--low",e).addClass("ui-slider-range-show-correct__tooltip__text--low-center"));return correct_string}(questionFieldset)),"correct"!==correct_string&&"incorrect"!==correct_string)return!1;q(".enp-question__container").addClass("enp-question__container--explanation").removeClass("enp-question__container--unanswered"),q(this).closest(".enp-question__fieldset").addClass("enp-question__answered");var n=function(e,t,n){if(0<q("#enp-explanation_"+e.question_id).length)return!1;!0===_.is_last_question(e)?question_next_step_text="View Results":question_next_step_text="Next Question";var i=e["question_responses_"+t+"_percentage"];i=_.reformat_number(i,100),explanationTemplate=r({question_id:e.question_id,question_explanation:e.question_explanation,question_explanation_title:t,question_explanation_percentage:i,question_next_step_text:question_next_step_text}),"function"==typeof n&&n(explanationTemplate);return explanationTemplate}(t,correct_string);q(".enp-question__submit").before(n),q(".enp-next-step").focus(),data=v(q(this)),url=q(".enp-question__form").attr("action"),q.ajax({type:"POST",url:url,data:data,dataType:"json"}).done(d).fail(function(e,t,n){console.log("AJAX failed",e.getAllResponseHeaders(),t,n)}).then(function(e,t,n){}).always(function(){})}),q(document).on("click",".enp-next-step",function(e){e.preventDefault(),url=q(".enp-question__form").attr("action"),data=v(q(this)),q(".enp-question__answered").addClass("enp-question--remove"),q(".enp-question__container").removeClass("enp-question__container--explanation").addClass("enp-question__container--unanswered"),q(".enp-question--on-deck").length&&(nextQuestion=q(".enp-question--on-deck"),f(nextQuestion)),q.ajax({type:"POST",url:url,data:data,dataType:"json"}).done(n).fail(function(e,t,n){console.log("AJAX failed",e.getAllResponseHeaders(),t,n)}).then(function(e,t,n){}).always(function(){})}),q(document).on("input",".enp-slider-input__input",function(){var e,t;e=O(q(this).data("sliderID")),t=q(this).val(),e.slider("value",t),sliderVal=e.slider("value")}),q(document).on("blur",".enp-slider-input__input",function(){var e,t,n;input=q(this),e=O(q(this).data("sliderID")),t=input.val(),n=e.slider("value"),parseInt(n)!==parseInt(t)&&(input.val(n),input.addClass("enp-slider-input__input--invalid-animation"),setTimeout(function(){input.removeClass("enp-slider-input__input--invalid-animation")},500))}),q(document).on("click",".enp-quiz-restart",function(e){u("quizRestarted")}),"undefined"!=typeof init_question_json&&(c(init_question_json),"mc"===init_question_json.question_type?b(init_question_json):"slider"===init_question_json.question_type&&z(init_question_json)),e=quiz_json,q("#quiz").data("quizJSON",e),m(),u("sendURL"),h(),q(".enp-question-image").load(function(){m()})});