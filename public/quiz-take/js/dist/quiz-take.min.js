jQuery(document).ready(function(e){function t(t,n,i){e(".enp-question__submit").remove();var s=e.parseJSON(i.responseText);"question"===s.next_state&&o(s.next_question)}function n(t){e("#question_"+t.question_id).data("questionJSON",t)}function o(t){var o={question_id:t.question_id,question_type:t.question_type,question_title:t.question_title};if(new_questionTemplate=x(o),e(".enp-question__fieldset").before(new_questionTemplate),e("#question_"+t.question_id).addClass("enp-question--on-deck"),n(t),""!==t.question_image){var i={question_image_src:t.question_image_src,question_image_srcset:t.question_image_srcset,question_image_alt:t.question_image_alt};new_questionImageTemplate=v(i),e("#question_"+t.question_id+" .enp-question__question").after(new_questionImageTemplate)}if("mc"===t.question_type){for(var s in t.mc_option)mc_option_id=t.mc_option[s].mc_option_id,mc_option_content=t.mc_option[s].mc_option_content,mcOptionData={mc_option_id:mc_option_id,mc_option_content:mc_option_content},new_mcOption=h(mcOptionData),e("#question_"+t.question_id+" .enp-question__submit").before(new_mcOption);d(t)}else"slider"===t.question_type}function i(t){questionNumber=parseInt(t)+1,totalQuestions=_.get_total_questions(),progressBarWidth=questionNumber/totalQuestions*100,100===progressBarWidth&&(progressBarWidth=95),progressBarWidth+="%",e(".enp-quiz__progress__bar__question-count__current-number").text(questionNumber),e(".enp-quiz__progress__bar").css("width",progressBarWidth)}function s(e){e.addClass("enp-question--show").removeClass("enp-question--on-deck"),questionShowJSON=e.data("questionJSON"),questionOrder=questionShowJSON.question_order,i(questionOrder)}function a(t){return userAction=t.attr("name")+"="+t.val(),doing_ajax="doing_ajax=doing_ajax",data=e(".enp-question__form").serialize()+"&"+userAction+"&"+doing_ajax,data}function u(e,t,n){console.log("generating explanation"),_.is_last_question(e)===!0?question_next_step_text="View Results":question_next_step_text="Next Question";var o=e["question_responses_"+t+"_percentage"];return o=_.reformat_number(o,100),explanationTemplate=b({question_id:e.question_id,question_explanation:e.question_explanation,question_explanation_title:t,question_explanation_percentage:o,question_next_step_text:question_next_step_text}),"function"==typeof n&&n(explanation),explanationTemplate}function r(t,n,i){var _=e.parseJSON(i.responseText);console.log(_),"quiz_end"===_.state?(qEndTemplate=m(_.quiz_end),e(".enp-question__form").append(qEndTemplate),e(".enp-results").addClass(".enp-question--on-deck").addClass("enp-question--show").removeClass("enp-question--on-deck"),e(".enp-quiz__progress__bar").css("width","100%"),e(".enp-quiz__progress__bar__question-count__total-questions").append(" Correct"),e(".enp-quiz__progress__bar__question-count__current-number").text(_.quiz_end.score_total_correct),e("#enp-results__score__circle__path").attr("class","enp-results__score__circle__resetOffset"),animateScoreID=window.setTimeout(f,250)):"question"===_.state&&(e(".enp-question--show").length||(o(_.next_question),nextQuestion=e(".enp-question--on-deck"),s(nextQuestion))),e(".enp-question__answered").remove()}function c(t,n){var o;return e(".enp-option__input",t).each(function(t,i){return"1"===e(this).data("correct")?(o=e(this),"function"==typeof n&&n(e(this)),!1):void 0}),o}function p(t,n){var o;return e(".enp-option__input",t).each(function(t,i){"0"===e(this).data("correct")&&(o=e(this),"function"==typeof n&&n(e(this)))}),o}function l(e){e.hasClass("enp-option__input--incorrect-clicked")||e.addClass("enp-option__input--slide-hide")}function q(e){e.addClass("enp-option__input--correct")}function d(t){if("mc"===t.question_type)for(var n in t.mc_option)mc_option_id=t.mc_option[n].mc_option_id,mc_option_correct=t.mc_option[n].mc_option_correct,e("#enp-option__"+mc_option_id).data("correct",mc_option_correct)}function m(e,t){return quizEndData={score:e.score,score_circle_dashoffset:e.score_circle_dashoffset,quiz_end_title:e.quiz_end_title,quiz_end_content:e.quiz_end_content},qEndTemplate=w(quizEndData),"function"==typeof t&&t(explanation),qEndTemplate}function f(){e("#enp-results__score__circle__path").attr("class","enp-results__score__circle__setOffset")}function g(t){e("#quiz").data("quizJSON",t)}_.reformat_number=function(e,t,n){return""===t&&(t=1),""===n&&(n=0),e*=t,e=e.toFixed(n)},_.is_last_question=function(e){return questionNumber=parseInt(e.question_order)+1,totalQuestions=_.get_total_questions(),console.log(questionNumber),console.log(totalQuestions),questionNumber===totalQuestions?!0:!1},_.get_total_questions=function(){return quizJSON=e("#quiz").data("quizJSON"),quizJSON.questions.length},_.templateSettings={interpolate:/\{\{(.+?)\}\}/g};var h=_.template(e("#mc_option_template").html()),x=_.template(e("#question_template").html()),v=_.template(e("#question_image_template").html()),b=_.template(e("#question_explanation_template").html()),w=_.template(e("#quiz_end_template").html());e(document).on("click",".enp-option__label",function(t){if(!e(".enp-question__container--unanswered").length)return!1;var n=e(this).prev(".enp-option__input");n.prop("checked")||n.prop("checked",!0),e(".enp-question__submit").trigger("click")}),e(document).on("click",".enp-question__submit",function(n){n.preventDefault(),e(".enp-question__container").addClass("enp-question__container--explanation").removeClass("enp-question__container--unanswered");var o=e(".enp-option__input:checked"),i=o.data("correct");"1"===i?(correct_string="correct",o.addClass("enp-option__input--correct-clicked"),q(o)):(correct_string="incorrect",o.addClass("enp-option__input--incorrect-clicked"),correctInput=c(e(".enp-question__fieldset"),q)),p(e(".enp-question__fieldset"),l);var s=e(this).closest(".enp-question__fieldset").data("questionJSON");e(this).closest(".enp-question__fieldset").addClass("enp-question__answered");var _=u(s,correct_string);e(".enp-question__submit").before(_),data=a(e(this)),url=e(".enp-question__form").attr("action"),e.ajax({type:"POST",url:url,data:data,dataType:"json"}).done(t).fail(function(e,t,n){console.log("AJAX failed",e.getAllResponseHeaders(),t,n)}).then(function(e,t,n){console.log("AJAX after finished")}).always(function(){})}),e(document).on("click",".enp-next-step",function(t){t.preventDefault(),url=e(".enp-question__form").attr("action"),data=a(e(this)),e(".enp-question__answered").addClass("enp-question--remove"),e(".enp-question__container").removeClass("enp-question__container--explanation").addClass("enp-question__container--unanswered"),e(".enp-question--on-deck").length&&(nextQuestion=e(".enp-question--on-deck"),s(nextQuestion)),e.ajax({type:"POST",url:url,data:data,dataType:"json"}).done(r).fail(function(e,t,n){console.log("AJAX failed",e.getAllResponseHeaders(),t,n)}).then(function(e,t,n){console.log("AJAX after finished")}).always(function(){})}),n(init_question_json),d(init_question_json),g(quiz_json)});