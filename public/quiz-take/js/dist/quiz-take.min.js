jQuery(document).ready(function(e){function t(){height=i(),console.log("sending body height of "+height),json='{"quiz_id":"'+_.get_quiz_id()+'","ab_test_id":"'+_.get_ab_test_id()+'","height":"'+height+'"}',parent.postMessage(json,"*")}function i(){var t=document.getElementById("enp-quiz-container").offsetHeight;if(e(".enp-option__input--slide-hide").length){var i=0;e(".enp-option__input--slide-hide").each(function(){var t=e(this).next(".enp-option__label");i+=t.outerHeight(!0)}),t-=i}return t+"px"}function n(e){return"string"!=typeof e.data?!1:(data=_.is_json_string(e.data),void("request"===data.status&&"sendBodyHeight"===data.action&&t()))}function s(i,n,s){e(".enp-question__submit").remove();var o=e.parseJSON(s.responseText);console.log(o),"question"===o.next_state&&r(o.next_question),t()}function o(t){e("#question_"+t.question_id).data("questionJSON",t)}function r(t){var i={question_id:t.question_id,question_type:t.question_type,question_title:t.question_title};new_questionTemplate=J(i),e(".enp-question__fieldset").before(new_questionTemplate),e("#question_"+t.question_id).addClass("enp-question--on-deck"),o(t),""!==t.question_image&&d(t),"mc"===t.question_type?w(t):"slider"===t.question_type&&C(t)}function a(t){questionNumber=parseInt(t)+1,totalQuestions=_.get_total_questions(),progressBarWidth=questionNumber/totalQuestions*100,100===progressBarWidth&&(progressBarWidth=95),progressBarWidth+="%",e(".enp-quiz__progress__bar__question-count__current-number").text(questionNumber),e(".enp-quiz__progress__bar").css("width",progressBarWidth)}function l(e){e.addClass("enp-question--show").removeClass("enp-question--on-deck"),questionShowJSON=e.data("questionJSON"),questionOrder=questionShowJSON.question_order,a(questionOrder)}function u(t){return userAction=t.attr("name")+"="+t.val(),doing_ajax="doing_ajax=doing_ajax",data=e(".enp-question__form").serialize()+"&"+userAction+"&"+doing_ajax,data}function d(t){var i={question_image_src:t.question_image_src,question_image_srcset:t.question_image_srcset,question_image_alt:t.question_image_alt};new_questionImageTemplate=y(i),e("#question_"+t.question_id+" .enp-question__question").after(new_questionImageTemplate)}function c(e,t,i){_.is_last_question(e)===!0?question_next_step_text="View Results":question_next_step_text="Next Question";var n=e["question_responses_"+t+"_percentage"];return n=_.reformat_number(n,100),explanationTemplate=j({question_id:e.question_id,question_explanation:e.question_explanation,question_explanation_title:t,question_explanation_percentage:n,question_next_step_text:question_next_step_text}),"function"==typeof i&&i(explanationTemplate),explanationTemplate}function p(i,n,s){var o=e.parseJSON(s.responseText);console.log(o),"quiz_end"===o.state?(qEndTemplate=S(o.quiz_end),e(".enp-question__form").append(qEndTemplate),e(".enp-results").addClass("enp-question--on-deck").addClass("enp-question--show").removeClass("enp-question--on-deck"),e(".enp-quiz__progress__bar").css("width","100%"),e(".enp-quiz__progress__bar__question-count__total-questions").append(" Correct"),e(".enp-quiz__progress__bar__question-count__current-number").text(o.quiz_end.score_total_correct),e("#enp-results__score__circle__path").attr("class","enp-results__score__circle__resetOffset"),animateScoreID=window.setTimeout(N,250)):"question"===o.state&&(e(".enp-question--show").length||(r(o.next_question),nextQuestion=e(".enp-question--on-deck"),l(nextQuestion))),e(".enp-question__answered").remove(),t()}function q(t,i){var n;return e(".enp-option__input",t).each(function(t,s){return"1"===e(this).data("correct")?(n=e(this),"function"==typeof i&&i(e(this)),!1):void 0}),n}function g(t,i){var n;return e(".enp-option__input",t).each(function(t,s){"0"===e(this).data("correct")&&(n=e(this),"function"==typeof i&&i(e(this)))}),n}function h(e){e.hasClass("enp-option__input--incorrect-clicked")||e.addClass("enp-option__input--slide-hide")}function m(e){e.addClass("enp-option__input--correct")}function f(t){for(var i in t.mc_option)mc_option_id=t.mc_option[i].mc_option_id,mc_option_correct=t.mc_option[i].mc_option_correct,e("#enp-option__"+mc_option_id).data("correct",mc_option_correct)}function w(t){t.mc_option=_.shuffle(t.mc_option);for(var i in t.mc_option)mc_option_id=t.mc_option[i].mc_option_id,mc_option_content=t.mc_option[i].mc_option_content,mcOptionData={mc_option_id:mc_option_id,mc_option_content:mc_option_content},new_mcOption=I(mcOptionData),e("#question_"+t.question_id+" .enp-question__submit").before(new_mcOption);f(t)}function v(t){question=e("#question_"+t.question_id),sliderInput=e(".enp-slider-input__input",question),sliderInput.data("sliderJSON",t.slider),x(sliderInput,t.slider)}function x(t,i){slider=e('<div class="enp-slider" aria-hidden="true" role="presentation"></div>'),slider.data("sliderID",i.slider_id),e(t).data("sliderID",i.slider_id),e(slider).slider({range:"min",value:parseFloat(i.slider_start),min:parseFloat(i.slider_range_low),max:parseFloat(i.slider_range_high),step:parseFloat(i.slider_increment),slide:function(i,n){e(t).val(n.value)}}),sliderInputContainer=e(t).parent(),sliderInputContainer.after(slider),sliderTakeRangeHelpers=T({slider_range_low:parseFloat(i.slider_range_low),slider_range_high:parseFloat(i.slider_range_high)}),sliderInputContainer.append(sliderTakeRangeHelpers)}function O(t,i){var n;return e(".enp-slider").each(function(){return e(this).data("sliderID")===t?(n=e(this),"function"==typeof i&&i(e(this)),!1):void 0}),n}function C(t){sliderJSON=t.slider,sliderData={slider_id:sliderJSON.slider_id,slider_range_low:sliderJSON.slider_range_low,slider_range_high:sliderJSON.slider_range_high,slider_correct_low:sliderJSON.slider_correct_low,slider_correct_high:sliderJSON.slider_correct_high,slider_increment:sliderJSON.slider_increment,slider_start:sliderJSON.slider_start,slider_prefix:sliderJSON.slider_prefix,slider_suffix:sliderJSON.slider_suffix,slider_input_size:sliderJSON.slider_range_high.length},slider=z(sliderData),e("#question_"+t.question_id+" .enp-question__submit").before(slider),v(t)}function S(e,t){return quizEndData={score_percentage:e.score_percentage,score_circle_dashoffset:e.score_circle_dashoffset,quiz_end_title:e.quiz_end_title,quiz_end_content:e.quiz_end_content},qEndTemplate=L(quizEndData),"function"==typeof t&&t(explanation),qEndTemplate}function N(){e("#enp-results__score__circle__path").attr("class","enp-results__score__circle__setOffset")}function b(t){e("#quiz").data("quizJSON",t)}if(_.reformat_number=function(e,t,i){return""===t&&(t=1),""===i&&(i=0),e*=t,e=e.toFixed(i)},_.is_last_question=function(e){return questionNumber=parseInt(e.question_order)+1,totalQuestions=_.get_total_questions(),console.log(questionNumber),console.log(totalQuestions),questionNumber===totalQuestions?!0:!1},_.get_total_questions=function(){return quizJSON=e("#quiz").data("quizJSON"),quizJSON.questions.length},_.is_json_string=function(e){try{json=JSON.parse(e)}catch(t){return!1}return json},_.get_quiz_id=function(){return json=e("#quiz").data("quizJSON"),json.quiz_id},_.get_ab_test_id=function(){return ab_test_id_json.ab_test_id},_.templateSettings={interpolate:/\{\{(.+?)\}\}/g},e("#question_template").length)var J=_.template(e("#question_template").html()),I=_.template(e("#mc_option_template").html()),z=_.template(e("#slider_template").html()),T=_.template(e("#slider_range_helpers_template").html()),y=_.template(e("#question_image_template").html());if(e("#question_explanation_template").length)var j=_.template(e("#question_explanation_template").html());if(e("#quiz_end_template").length)var L=_.template(e("#quiz_end_template").html());window.addEventListener("message",n,!1),e(document).on("click",".enp-option__label",function(t){if(!e(".enp-question__container--unanswered").length)return!1;var i=e(this).prev(".enp-option__input");i.prop("checked")||i.prop("checked",!0),e(".enp-question__submit").trigger("click")}),e(document).on("click",".enp-question__submit",function(t){t.preventDefault(),e(".enp-question__container").addClass("enp-question__container--explanation").removeClass("enp-question__container--unanswered");var i=e(this).closest(".enp-question__fieldset").data("questionJSON");if("mc"===i.question_type){var n=e(".enp-option__input:checked"),o=n.data("correct");"1"===o?(correct_string="correct",n.addClass("enp-option__input--correct-clicked"),m(n)):(correct_string="incorrect",n.addClass("enp-option__input--incorrect-clicked"),correctInput=q(e(".enp-question__fieldset"),m)),g(e(".enp-question__fieldset"),h)}else"slider"===i.question_type&&(sliderInput=e(this).parent().find(".enp-slider-input__input"),sliderSubmittedVal=parseFloat(sliderInput.val()),sliderJSON=sliderInput.data("sliderJSON"),sliderCorrectLow=parseFloat(sliderJSON.slider_correct_low),sliderCorrectHigh=parseFloat(sliderJSON.slider_correct_high),questionFieldset=e(this).parent(),sliderCorrectLow<=sliderSubmittedVal&&sliderSubmittedVal<=sliderCorrectHigh?correct_string="correct":correct_string="incorrect",sliderInput.addClass("enp-slider-input__input--"+correct_string),e(".ui-slider-range-min",questionFieldset).addClass("ui-slider-range-min--"+correct_string),e(".ui-slider-handle",questionFieldset).addClass("ui-slider-handle--"+correct_string),("incorrect"===correct_string||sliderCorrectLow!==sliderCorrectHigh)&&(e(".enp-slider-input__range-helper__number").hide(),e(".ui-slider-range-min",questionFieldset).after('<div class="ui-slider-range-show-correct ui-slider-range"></div>'),sliderRangeLow=parseFloat(sliderJSON.slider_range_low),sliderRangeHigh=parseFloat(sliderJSON.slider_range_high),sliderIncrement=parseFloat(sliderJSON.slider_increment),sliderTotalIntervals=(sliderRangeHigh-sliderRangeLow)/sliderIncrement,correctLowIntervals=sliderCorrectLow/sliderIncrement,correctHighIntervals=sliderCorrectHigh/sliderIncrement,correctLowOffsetLeft=correctLowIntervals/sliderTotalIntervals*100,correctHighOffsetLeft=correctHighIntervals/sliderTotalIntervals*100,correctRangeWidth=correctHighOffsetLeft-correctLowOffsetLeft,e(".ui-slider-range-show-correct",questionFieldset).css({width:correctRangeWidth+"%",left:correctLowOffsetLeft+"%"}).text(sliderJSON.sliderCorrectLow),toolTipHTML='<div class="ui-slider-range-show-correct__tooltip ui-slider-range-show-correct__tooltip--low"><span class="ui-slider-range-show-correct__tooltip__text ui-slider-range-show-correct__tooltip__text--low">'+sliderCorrectLow+"</span></div>",sliderCorrectLow!==sliderCorrectHigh&&(toolTipHTML+='<div class="ui-slider-range-show-correct__tooltip ui-slider-range-show-correct__tooltip--high"><span class="ui-slider-range-show-correct__tooltip__text ui-slider-range-show-correct__tooltip__text--high">'+sliderCorrectHigh+"</span></div>"),e(".ui-slider-range-show-correct",questionFieldset).append('<div class="ui-slider-range-show-correct__tooltip-container">'+toolTipHTML+"</div>"),sliderCorrectLow===sliderCorrectHigh&&e(".ui-slider-range-show-correct__tooltip__text--low",questionFieldset).addClass("ui-slider-range-show-correct__tooltip__text--low-center")));e(this).closest(".enp-question__fieldset").addClass("enp-question__answered");var r=c(i,correct_string);e(".enp-question__submit").before(r),data=u(e(this)),url=e(".enp-question__form").attr("action"),e.ajax({type:"POST",url:url,data:data,dataType:"json"}).done(s).fail(function(e,t,i){console.log("AJAX failed",e.getAllResponseHeaders(),t,i)}).then(function(e,t,i){console.log("AJAX after finished")}).always(function(){})}),e(document).on("click",".enp-next-step",function(t){t.preventDefault(),url=e(".enp-question__form").attr("action"),data=u(e(this)),e(".enp-question__answered").addClass("enp-question--remove"),e(".enp-question__container").removeClass("enp-question__container--explanation").addClass("enp-question__container--unanswered"),e(".enp-question--on-deck").length&&(nextQuestion=e(".enp-question--on-deck"),l(nextQuestion)),e.ajax({type:"POST",url:url,data:data,dataType:"json"}).done(p).fail(function(e,t,i){console.log("AJAX failed",e.getAllResponseHeaders(),t,i)}).then(function(e,t,i){console.log("AJAX after finished")}).always(function(){})}),e(document).on("input",".enp-slider-input__input",function(){var t,i,n;i=e(this).data("sliderID"),t=O(i),n=e(this).val(),t.slider("value",n),sliderVal=t.slider("value")}),e(document).on("blur",".enp-slider-input__input",function(){var t,i,n,s;input=e(this),i=e(this).data("sliderID"),t=O(i),n=input.val(),s=t.slider("value"),parseInt(s)!==parseInt(n)&&(input.val(s),input.addClass("enp-slider-input__input--invalid-animation"),setTimeout(function(){input.removeClass("enp-slider-input__input--invalid-animation")},500))}),"undefined"!=typeof init_question_json&&(o(init_question_json),"mc"===init_question_json.question_type?f(init_question_json):"slider"===init_question_json.question_type&&v(init_question_json)),b(quiz_json),t(),e(".enp-question-image").load(function(){t()})});