function EnpIframeQuiz(e){"use strict";this.iframe=e.iframe,this.iframeID=e.iframe.id,this.quizID=e.quizID,this.abTestID=e.abTestID,this.parentURL=e.parentURL,this.siteName=this.setSiteName(enpGetFBSiteNameMeta()),this.saveEmbedSiteComplete=!1,this.saveEmbedQuizComplete=!1,this.embedSiteID=!1,this.embedQuizID=!1,this.onLoadIframe()}function handleEnpIframeMessage(e){var t,i,s,n,a,r;if(t=window.location.href,!/https?:\/\/(?:local.quiz|(?:(?:local|dev|test)\.)?engagingnewsproject\.org|(?:engagingnews|enpdev)\.(?:staging\.)?wpengine\.com)\b/.test(e.origin))return!1;if("string"!=typeof e.data)return!1;if(s=JSON.parse(e.data),"0"===s.ab_test_id?(n="enp-quiz-iframe-"+s.quiz_id,abTestID=!1):(n="enp-ab-test-iframe-"+s.ab_test_id,abTestID=s.ab_test_id),iframe=document.getElementById(n),i={iframe:iframe,parentURL:t,abTestID:abTestID,quizID:s.quiz_id},0===enpIframes.length)enpIframes.push(new EnpIframeQuiz(i)),a=enpIframes[0];else{r=!1;for(var o=0;o<enpIframes.length;o++)enpIframes[o].iframeID===iframe.id&&(a=enpIframes[o],r=!0);r===!1&&(enpIframes.push(new EnpIframeQuiz(i)),a=enpIframes[enpIframes.length-1])}a.receiveIframeMessage(e.origin,s)}function enpGetFBSiteNameMeta(){var e=document.querySelector('meta[property="og:site_name"]');return!!e&&e.content}EnpIframeQuiz.prototype.getSaveEmbedSiteComplete=function(){return this.saveEmbedSiteComplete},EnpIframeQuiz.prototype.setSaveEmbedSiteComplete=function(e){"boolean"==typeof e&&(this.saveEmbedSiteComplete=e)},EnpIframeQuiz.prototype.getSaveEmbedQuizComplete=function(){return this.saveEmbedQuizComplete},EnpIframeQuiz.prototype.setSaveEmbedQuizComplete=function(e){"boolean"==typeof e&&(this.saveEmbedQuizComplete=e)},EnpIframeQuiz.prototype.setSiteName=function(e){return e&&"string"==typeof e?this.siteName=e:this.siteName=this.parentURL,this.siteName},EnpIframeQuiz.prototype.getSiteName=function(){return this.siteName},EnpIframeQuiz.prototype.receiveIframeMessage=function(e,t){var i;return i={},"setHeight"===t.action?i.setQuizHeight=this.setQuizHeight(t.height):"scrollToQuiz"===t.action||"quizRestarted"===t.action?i.scrollToQuizResponse=this.scrollToQuiz():"sendURL"===t.action?i.sendParentURLResponse=this.sendParentURL():"saveSite"===t.action&&this.saveEmbedSite(e,t,this.handleEmbedSiteResponse,this),i},EnpIframeQuiz.prototype.onLoadIframe=function(){this.addIframeStyles(),this.getQuizHeight(),this.sendParentURL()},EnpIframeQuiz.prototype.getQuizHeight=function(){var e;e='{"status":"request","action":"sendBodyHeight"}',this.iframe.contentWindow.postMessage(e,this.iframe.src)},EnpIframeQuiz.prototype.sendParentURL=function(){var e;return!/https?:\/\/(?:local.quiz|(?:(?:local|dev|test)\.)?engagingnewsproject\.org|(?:engagingnews|enpdev)\.(?:staging\.)?wpengine\.com)\/enp-quiz\/quiz-preview\/\d+\b/.test(this.parentURL)&&(e='{"status":"request","action":"setShareURL","parentURL":"'+this.parentURL+'"}',void this.iframe.contentWindow.postMessage(e,this.iframe.src))},EnpIframeQuiz.prototype.setQuizHeight=function(e){return!!/([0-9])px/.test(e)&&(this.iframe.style.height=e,e)},EnpIframeQuiz.prototype.scrollToQuiz=function(){var e=!1,t=this.iframe.getBoundingClientRect().top;return-20<t&&t<100?e="noScroll":(scrollBy(0,t-10),e="scrolledTop"),e},EnpIframeQuiz.prototype.addIframeStyles=function(){var e=".enp-quiz-iframe { -webkit-transition: all .25s ease-in-out;transition: all .25s ease-in-out; }",t=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),t.appendChild(i)},EnpIframeQuiz.prototype.serialize=function(e){var t="";for(var i in e)t+=i+"="+e[i]+"&";return t=t.slice(0,t.length-1)},EnpIframeQuiz.prototype.saveEmbedSite=function(e,t,i,s){if(this.getSaveEmbedSiteComplete()===!0)return!1;var n,a=new XMLHttpRequest;a.open("POST",e+"/wp-content/plugins/enp-quiz/database/class-enp_quiz_save_embed.php"),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){a.readyState===XMLHttpRequest.DONE&&200===a.status?(s.setSaveEmbedSiteComplete(!0),n=JSON.parse(a.responseText),"success"===n.status?(n.origin=e,n.quiz_id=t.quiz_id,"function"==typeof i&&i(n,s)):console.log("XHR request for saveEmbedSite successful but returned response error: "+JSON.stringify(n))):200!==a.status&&console.log("Request failed.  Returned status of "+a.status)},t.embed_site_url=this.parentURL,t.embed_site_name=this.getSiteName(),t.save="embed_site",t.action="insert",t.doing_ajax="true",a.send(encodeURI(this.serialize(t)))},EnpIframeQuiz.prototype.handleEmbedSiteResponse=function(e,t){return t.embedSiteID=e.embed_site_id,0<parseInt(t.embedSiteID)?(t.saveEmbedQuiz(e,t.handleEmbedQuizResponse,t),e):void console.log("Could't locate a valid Embed Site")},EnpIframeQuiz.prototype.saveEmbedQuiz=function(e,t,i){if(this.getSaveEmbedQuizComplete()===!0)return!1;var s,n=new XMLHttpRequest;n.open("POST",e.origin+"/wp-content/plugins/enp-quiz/database/class-enp_quiz_save_embed.php"),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&200===n.status?(i.setSaveEmbedQuizComplete(!0),s=JSON.parse(n.responseText),"success"===s.status?"function"==typeof t&&t(s,i):console.log("XHR request for saveEmbedQuiz successful but returned response error: "+JSON.stringify(s))):200!==n.status&&console.log("Request failed.  Returned status of "+n.status)},embed_quiz={save:"embed_quiz",embed_site_id:e.embed_site_id,quiz_id:e.quiz_id,embed_quiz_url:this.parentURL,doing_ajax:"true"},n.send(encodeURI(this.serialize(embed_quiz)))},EnpIframeQuiz.prototype.handleEmbedQuizResponse=function(e,t){return t.embedQuizID=e.embed_quiz_id,0<parseInt(t.embedQuizID)?e:void console.log("Could't locate a valid Embed Quiz")};var enpIframes=[];window.addEventListener("message",handleEnpIframeMessage,!1);